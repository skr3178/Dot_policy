"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["2749"],{89043:function(e,t,n){n.d(t,{Z:()=>i});let i={container:"container-PNh5cP",containerBulwark:"containerBulwark-Y0wz4B",noPodcasts:"noPodcasts-reia2s"}},62126:function(e,t,n){n.d(t,{m:()=>et});var i=n(16584),o=n(30396),r=n(80569),a=n.n(r),s=n(95441),l=n(15771),c=n(19081),d=n(6490),u=n(58175);let m=e=>{let{isOpen:t,onContinue:n}=e,{iString:r}=(0,s.M1)(),[a,m]=(0,o.eJ)(!1);return(0,i.BX)(d.u_,{isOpen:t,children:[(0,i.tZ)(d.xB,{title:r("Switch to Bitcoin"),showClose:!1}),(0,i.tZ)(d.fe,{children:(0,i.BX)(c.tu,{gap:24,children:[(0,i.BX)(c.tu,{gap:16,children:[(0,i.tZ)(u.xv.B4,{translated:!0,children:"Switching to Bitcoin will end your auto-renewing credit card payments."}),(0,i.BX)(u.xv.B4,{translated:!0,children:["Please note that Substack cannot process refunds or auto-renewals for Bitcoin payments. You will now be sent to"," ",(0,i.tZ)("a",{href:"https://opennode.com",target:"_blank",rel:"noopener",children:"OpenNode"})," ","to complete your checkout."]})]}),(0,i.tZ)(l.zx,{onClick:()=>{m(!0),n()},disabled:a,children:r("Continue")})]})})]})};var p=n(25469),_=n(17876),h=n(94184),g=n.n(h),v=n(51776);let y="themed-qm5g5y",b=e=>{let{placeholder:t,maxLength:n,value:o,symbol:r,themed:a=!1,onChange:s}=e;return(0,i.BX)(c.gq,{alignItems:"center",justifyContent:"start",className:g()("inputContainer-JJXl4U",{[y]:a}),children:[(0,i.tZ)(u.xv.B3,{as:"span",color:a?"pub-secondary-text":"secondary",weight:"semibold",className:"currencyInput-n4aG03",children:r}),(0,i.tZ)(v.oi,{name:"Confirm Founding Price","aria-label":"Confirm founding price",value:o,placeholder:t,maxLength:n,onChange:e=>s(e.currentTarget.value),onInput:e=>s(e.currentTarget.value),className:g()("inputField-ZlLLCs",{[y]:a})})]})};var f=n(68833),Z=n(84864);let w=e=>{let{currency:t,isValid:n,newUpgradeModal:r,planName:a,price:l,setValidationState:d}=e,[m,h]=(0,o.eJ)(""),g=parseInt(l);(0,o.d4)(()=>((0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_REQUIRED,{price:l,source:"upgrade modal"}),()=>{n||(0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_DISMISSED,{price:l,source:"upgrade modal"})}),[]);let{iString:v}=(0,s.M1)(),y=(0,Z.isZeroDecimalCurrency)(t)?1:100;return(0,i.BX)(c.tu,{font:r?"text":void 0,gap:8,paddingTop:8*!r,borderTop:r?void 0:"detail",alignItems:"start",justifyContent:"start",children:[(0,i.BX)(u.xv,{translated:!0,as:"p",size:r?14:17,color:"secondary",children:["Please confirm you want to pay"," ",(0,i.tZ)(u.xv,{as:"span",color:"primary",weight:"semibold",children:I18N.p(g?(0,Z.centsToPriceString)(g*y,t):l)})," ","per year for a ",I18N.p(null!=a?a:v("Founding Member"))," subscription by typing the price below."]}),(0,i.BX)(c.gq,{alignItems:"center",justifyContent:"start",gap:8,style:{width:"100%"},children:[(0,i.tZ)(b,{placeholder:l,symbol:(0,Z.currencySymbol)(t),maxLength:l.length,value:m,themed:!1,onChange:e=>{e===l?(d(!0),h(e)):e!==m&&(d(!1),h(e))}}),n?(0,i.tZ)(p.Z,{size:24,style:{color:"var(--color-accent-fg-green)"}}):(0,i.tZ)(_.Z,{size:24,style:{color:"var(--color-accent-fg-red)"}})]})]})};var C=n(89734),x=n.n(C),P=n(58865),I=n(7409),S=n(99282),N=n(64515);let B=e=>(0,i.tZ)(N.l,(0,S._)((0,I._)({},e),{name:"WarningIcon",svgParams:{viewBox:"-2 -2 18 18"},children:(0,i.tZ)("path",{d:"M8 0C3.582 0 0 3.582 0 8s3.582 8 8 8 8-3.582 8-8S12.418 0 8 0zM9 12H7v-2h2V12zM9 8H7V4h2V8z"})}));var k=n(87077),M=n(31582);let A={outlineWrapper:"outlineWrapper-MqmfKS",outlineWrapperWithWarning:"outlineWrapperWithWarning-x5ALXu",warningContainer:"warningContainer-lQlVcA",outlineWrapperSelected:"outlineWrapperSelected-KXkgz5",amountInput:"amountInput-pcn7kh",amountInputDeselected:"amountInputDeselected-W75Nrd"};function R(){let e=(0,P._)([" per ",""]);return R=function(){return e},e}function F(){let e=(0,P._)(["Amount must be greater than ",""]);return F=function(){return e},e}let E=e=>{var t;let{amount:n,currency:r,isSelected:a,outlineOnSelect:l,plan:c,usePer:d,showDuration:u=!0,disableInput:m=!1,className:p,disableWarning:_,onChangeAmount:h,truncateInterval:v=!1}=e,y=(0,o.sO)(null),[b,f]=(0,o.eJ)(!1),w=(0,o.I4)(e=>{h(e.toString().replace(/[^\d.]/g,""))},[h]);r||(r=c.currency),(0,o.d4)(()=>{let e=(0,M.vq)(c,r);f(!!(!_&&e&&null!==n&&r&&parseFloat(Number((0,Z.isZeroDecimalCurrency)(r)?n:100*Number(n)).toFixed(2))<e&&a))},[n,r,_,a,c]),(0,o.bt)(()=>{setTimeout(()=>{y.current&&(y.current.style.width="1px",y.current.style.width="".concat(y.current.scrollWidth,"px"),y.current.scrollLeft=0)},0)},[n,y]),(0,o.d4)(()=>{a&&(y.current.focus(),y.current.select())},[y,a]);let{iTemplate:C,iString:x}=(0,s.M1)(),P=v&&"year"===c.interval?"yr":v&&"month"===c.interval?"mo":c.interval;return(0,i.BX)("span",{className:g()(A.outlineWrapper,p,{[A.outlineWrapperSelected]:l&&a,[A.outlineWrapperWithWarning]:b}),children:[(0,Z.centsToPriceString)(100,r).replace("1",""),(0,i.tZ)("input",{disabled:m,ref:y,className:g()(A.amountInput,{[A.amountInputDeselected]:!a}),id:"money-variable-amount",type:"text","aria-label":"founding member amount",autoComplete:"off",value:"string"==typeof n?n:c.amount/100,onKeyDown:e=>{"ArrowUp"===e.key?(w(Number(n||c.amount/100)+5),setTimeout(()=>{y.current.selectionStart=y.current.selectionEnd=y.current.value.length},0)):"ArrowDown"===e.key&&(!n||Number(n)>=5)&&(w(Number(n||c.amount/100)-5),setTimeout(()=>{y.current.selectionStart=y.current.selectionEnd=y.current.value.length},0))},onInput:e=>{w(e.target.value)}}),(0,i.tZ)("input",{name:"amount",type:"hidden",value:"string"==typeof n?100*(Number(n)||0):c.amount}),u&&"forever"!==c.interval&&(d?C(R(),x(P)):"/".concat(x(P))),b&&(0,i.tZ)("div",{className:A.warningContainer,children:(0,i.tZ)(k.u,{text:C(F(),(0,Z.centsToPriceString)(null!==(t=(0,M.vq)(c,r))&&void 0!==t?t:0,r)),children:(0,i.tZ)(B,{stroke:"white",height:20,fill:"red",strokeWidth:1})})})]})};var X=n(43570);let L=e=>{let{currency:t,foundingAmount:n,foundingName:o,isSelected:r,isCurrent:a,plan:l,onChangeAmount:d}=e,{iString:m}=(0,s.M1)();return(0,i.BX)(c.gq,{alignItems:"center",flex:"grow",gap:16,justifyContent:"space-between",children:[(0,i.tZ)(u.xv.B4,{weight:r?"semibold":"regular",children:(0,i.BX)(c.tu,{children:[(0,i.tZ)("div",{children:o}),(0,i.tZ)(E,{amount:n?n.toString():"",currency:t,isSelected:r,plan:l,usePer:!0,onChangeAmount:e=>{d(Number(e))}})]})}),a&&(0,i.tZ)(X.Vp,{priority:"primary",theme:"default",children:m("Current")})]})};var T=n(10656);let D=e=>{let{currency:t,plan:n,isCurrent:o,isSelected:r,language:a}=e,{iString:l}=(0,s.M1)();return(0,i.BX)(c.gq,{alignItems:"center",flex:"grow",gap:8,justifyContent:"space-between",children:[(0,i.tZ)(u.xv.B4,{weight:r?"semibold":"regular",children:(0,T.tS)(n,{currency:t,noTrial:!0,recurring:!0,language:a})}),o&&(0,i.tZ)(X.Vp,{priority:"primary",theme:"default",children:l("current")})]})};var z=n(57640),U=n(51699);let O=e=>{let{currency:t,foundingAmount:n,foundingName:o,isCurrent:r,language:a,plan:s,isSelected:l,onChangePlan:d,onChangeFoundingAmount:u}=e;return(0,i.BX)(c.gq,{alignItems:"center",as:"label",border:l?"accent":"detail-themed",gap:8,padding:16,radius:"sm",children:[(0,i.tZ)(z.Y,{checked:l,name:"plan",value:s.id,onClick:e=>{d({planId:e.target.value})}}),(0,U.F)({plan:s})?(0,i.tZ)(L,{currency:t,foundingAmount:n,foundingName:o,isCurrent:r,isSelected:l,plan:s,onChangeAmount:u}):(0,i.tZ)(D,{currency:t,plan:s,isCurrent:r,isSelected:l,language:a})]})},q=e=>{let{currency:t,foundingAmount:n,foundingName:o,getIsCurrentPlan:r,language:a,plans:s,selectedPlanId:l,onChangeFoundingAmount:d,onChangePlan:u}=e,m=x()(s,"amount").filter(e=>{var t;return!(null===(t=e.metadata)||void 0===t?void 0:t.bitcoin)}),p=null!=l?l:"";return(0,i.tZ)(c.tu,{gap:8,children:m.map(e=>(0,i.tZ)(O,{currency:t,foundingAmount:n,foundingName:o,isCurrent:r(e),isSelected:e.id===p,language:a,plan:e,onChangePlan:u,onChangeFoundingAmount:d}))})};var j=n(61254),V=n(24791);let W=e=>{let{currency:t,foundingAmount:n,foundingAmountLessThanMinimum:o,foundingName:r,hasChanges:a,sub:l,isNewPlanClassicFounding:d,newPlan:m}=e,{iString:p,language:_}=(0,s.M1)(),h=(0,Z.isZeroDecimalCurrency)(t)?1:100,g=a&&m&&(!d||!o),v=g?d?"".concat((0,Z.centsToPriceString)((null!=n?n:0)*h,t)," ").concat(p("per year")):(0,T.tS)(m,{language:_,currency:t}):p("N/A");return(0,i.BX)(c.tu,{gap:24,children:[(0,i.tZ)(u.xv.H4,{translated:!0,children:"Summary"}),(0,i.BX)("div",{className:"table-tzqeVd",children:[l.plan&&(0,i.BX)(i.HY,{children:[(0,i.tZ)(u.xv.B4,{color:"secondary",translated:!0,children:"Current plan"}),(0,i.BX)(c.tu,{"data-testid":"upgrade-summary-current-plan",gap:4,children:[(0,i.tZ)(u.xv.B4,{color:"secondary",align:"right",children:(0,V.sM)({sub:l})?r:H({plan:l.plan,language:_,currency:t})}),(0,V.sM)({sub:l})&&(0,i.tZ)(u.xv.B4,{color:"secondary",align:"right",children:(0,T.tS)(l.plan,{language:_,currency:t})})]})]}),(0,i.tZ)(u.xv.B4,{translated:!0,children:"New plan"}),(0,i.BX)(c.tu,{"data-testid":"upgrade-summary-new-plan",gap:4,children:[(0,i.tZ)(u.xv.B4,{align:"right",weight:g?"semibold":"regular",children:g?H({plan:m,language:_,currency:t}):p("N/A")}),d&&g&&(0,i.tZ)(u.xv.B4,{align:"right",weight:"semibold",children:v})]}),(0,i.tZ)(j.iz,{className:"table-divider-O5XQ7c"}),(0,i.tZ)(u.xv.B4,{translated:!0,children:"Total"}),(0,i.tZ)(u.xv.B4,{"data-testid":"upgrade-summary-total",align:"right",weight:g?"semibold":"regular",children:v})]})]})},H=e=>{var t,n,i;let{plan:o,language:r,currency:a}=e;return(null===(t=o.metadata)||void 0===t?void 0:t.founding)==="yes"?null!==(i=null===(n=o.metadata)||void 0===n?void 0:n.short_description)&&void 0!==i?i:"Founding membership":(0,T.tS)(o,{language:r,currency:a})};var K=n(33804),J=n(98914),G=n(26111);let Y={"left-column":"left-column-RH66AP"},$=e=>{var t,n;let{pub:i,sub:o}=e,r=(0,V.MO)(i);if(!r)return 0;let a=(0,M.$e)(r,o.currency),s=o.is_founding&&o.plan&&(0,V.sM)({sub:o})&&r.interval===o.plan.interval?(0,M.$e)(o.plan,o.currency):null,l=(0,Z.isZeroDecimalCurrency)(null!==(t=o.currency)&&void 0!==t?t:"usd")?1:100;return(null!==(n=null!=s?s:a)&&void 0!==n?n:0)/l},Q=e=>{let{pub:t,sub:n}=e,i=null==n?void 0:n.plan;if(!i)return null;if((0,V.sM)({sub:n})){let e=(0,V.MO)(t);if(e&&e.interval===i.interval)return e}return i},ee=e=>{var t,n;let{plan:i,sub:o}=e;return!!i&&!!o.plan&&(!!(i.id===o.plan.id||(0,V.sM)({sub:o})&&(0,U.F)({plan:i})&&i.interval===o.plan.interval)||i.amount===o.plan.amount&&i.interval===o.plan.interval&&i.currency===o.plan.currency&&(null===(t=i.metadata)||void 0===t?void 0:t.bitcoin)===(null===(n=o.plan.metadata)||void 0===n?void 0:n.bitcoin))},et=e=>{var t,n,r;let{isOpen:p,preselectedPlan:_,pub:h,sub:g,onClose:v}=e,{iString:y,language:b}=(0,s.M1)(),[C,x]=(0,o.eJ)(!1),[P,I]=(0,o.eJ)(Q({pub:h,sub:g})),[S,N]=(0,o.eJ)($({pub:h,sub:g})),[B,k]=(0,o.eJ)(!1),[M,A]=(0,o.eJ)(!1),[R,F]=(0,o.eJ)(null),E=(0,o.Ye)(()=>(h.plans||[]).filter(e=>{if(h.disable_annual_subscriptions){var t;return"year"!==e.interval||(null===(t=e.metadata)||void 0===t?void 0:t.founding)}return!h.disable_monthly_subscriptions||"month"!==e.interval}),[h.plans]),X=E.some(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.bitcoin}),L=null!==(t=(0,V.H$)(h))&&void 0!==t?t:"",T=null!==(n=g.currency)&&void 0!==n?n:"usd",D=(0,Z.isZeroDecimalCurrency)(T),z=D?1:100,O=P&&!ee({plan:P,sub:g}),j=S!==$({pub:h,sub:g}),H=O||j,et=parseFloat((S*z).toFixed(2))<(null!==(r=(0,V.rm)({pub:h,currency:T}))&&void 0!==r?r:0),en=P&&(0,U.F)({plan:P}),ei=en&&j&&(null!=S?S:0)>=(D?1e6:1e4),eo=!!(C||!H||ei&&!B||en&&et||R);(0,o.d4)(()=>{if(p&&_){if("yearly"===_){let e=E.find(e=>"year"===e.interval&&1===e.interval_count);e&&I(e)}else if("founding"===_){let e=(0,V.MO)(h);e&&I(e)}}},[p,E,_,h]);let er=(0,o.I4)(()=>{I(Q({pub:h,sub:g})),N($({pub:h,sub:g}))},[h,g]),ea=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&er(),(0,f.j)(f.FP.UPGRADE_PLAN_MODAL_DISMISSED,{plan:P}),v()},es=async function(){let{quantity:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!P)return;x(!0);let t=S&&en?S*z:void 0;if(ei&&!B){x(!1);return}try{var n;let i=await a().post("/api/v1/subscription/change_plan").send({planId:P.id,foundingAmount:t,quantity:e,token:(0,G.x)(window._preloads.original_url,"token")});(null===(n=i.body)||void 0===n?void 0:n.opennodePaymentUrl)?setTimeout(()=>{window.location.href=i.body.opennodePaymentUrl},30):(x(!1),alert(y("Success! You've changed your plan")),(0,f.j)(f.FP.UPGRADE_PLAN_MODAL_SUBMITTED,{plan:P,amount:null!=t?t:null}),(0,G.x)("redirect")?(0,J.uX)((0,G.x)("redirect"),{local_navigation:!1}):((0,J.iO)("change_plan"),window.location.reload()))}catch(e){x(!1),F((0,J.zx)(e))}},el=e=>{k(e),e&&(0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_SUBMITTED,{price:S,source:"upgrade modal"})};return E.length?(0,i.BX)("div",{children:[X&&(0,i.tZ)(m,{isOpen:M,onContinue:()=>es()}),(0,i.tZ)(d.u_,{isOpen:p,testId:"upgrade-plan-modal",width:700,onClose:C?()=>{}:v,fullscreenMobile:!0,children:(0,i.tZ)(K.w,{children:(0,i.BX)(c.gq,{direction:{desktop:"row",mobile:"column"},children:[(0,i.BX)(c.tu,{className:Y["left-column"],gap:16,padding:24,children:[(0,i.tZ)(u.xv.H3,{translated:!0,children:"Change Plan"}),(0,i.tZ)(q,{currency:T,foundingAmount:S,foundingName:L,getIsCurrentPlan:e=>ee({plan:e,sub:g}),language:b,plans:E,selectedPlanId:null==P?void 0:P.id,onChangeFoundingAmount:e=>{N(e),F(null),k(!1)},onChangePlan:e=>{let{planId:t}=e,{plans:n}=h,i=null==n?void 0:n.find(e=>e.id===t);i&&((0,f.j)(f.FP.UPGRADE_PLAN_MODAL_PLAN_CHANGED,{oldPlan:P,newPlan:i}),I(i),F(null))}})]}),(0,i.BX)(c.tu,{padding:24,flex:"grow",gap:80,children:[(0,i.BX)(c.tu,{flex:"grow",gap:40,children:[(0,i.tZ)(W,{currency:T,foundingAmount:S,foundingAmountLessThanMinimum:et,foundingName:L,hasChanges:H,isNewPlanClassicFounding:!!en,newPlan:P,sub:g}),ei&&(0,i.tZ)(w,{price:S?S.toString():"",isValid:B,planName:L,currency:T,setValidationState:e=>el(e),newUpgradeModal:!0}),R&&(0,i.tZ)(u.xv,{color:"error",size:14,font:"text",children:R})]}),(0,i.BX)(c.gq,{gap:12,justifyContent:"end",children:[(0,i.tZ)(l.zx,{priority:"secondary",onClick:()=>ea(),disabled:C,children:y("Cancel")}),(0,i.tZ)(l.zx,{priority:"primary",className:"confirm",onClick:()=>{var e;(null==P?void 0:null===(e=P.metadata)||void 0===e?void 0:e.bitcoin)?(ea(!1),A(!0)):es()},disabled:eo,children:C?y("Loading..."):y("Change plan")})]})]})]})})})]}):null}},95031:function(e,t,n){n.d(t,{_:()=>a});var i=n(16584),o=n(75744),r=n(58175);let a=e=>{let{hideTerms:t,pub:n,showIntrinioAttrib:a}=e,s=n.has_custom_tos||n.has_custom_privacy,l=(0,i.BX)("div",{className:"footer-copyright-blurb",children:["\xa9 ",new Date().getFullYear()," ",n&&n.copyright||"Substack Inc"]}),c=(0,i.BX)(i.HY,{children:[a&&(0,i.BX)(r.xv,{translated:!0,as:"div",className:"footer-copyright-blurb",children:["Market data by ",(0,i.tZ)("a",{href:"https://intrinio.com/",children:"Intrinio"})]}),!t&&(0,i.tZ)("div",{className:"footer-terms-blurb",children:(0,i.tZ)(o.nO,{publication:n})})]});return s?(0,i.BX)(i.HY,{children:[(0,i.BX)("div",{className:"footer-blurbs",children:[l,!t&&(0,i.tZ)("div",{className:"footer-terms-blurb",children:(0,i.tZ)(o.Ug,{pub:n})})]}),(0,i.BX)("div",{className:"footer-blurbs",children:[(0,i.tZ)("div",{className:"footer-copyright-blurb",children:"Substack"}),c]})]}):(0,i.BX)("div",{className:"footer-blurbs",children:[l,c]})}},57577:function(e,t,n){n.d(t,{Z:()=>ec});var i=n(7409),o=n(99282),r=n(16584),a=n(30396),s=n(94184),l=n.n(s),c=n(14293),d=n.n(c),u=n(24840),m=n(80569),p=n.n(m),_=n(31131),h=n(99869),g=n(67358),v=n(12561),y=n(59154),b=n(79138),f=n(37632),Z=n(4473),w=n(39535),C=n(75697),x=n(58474),P=n(95441),I=n(68833),S=n(15771),N=n(36500),B=n(84747),k=n(63651),M=n(47929);function A(e){let{pub:t,user:n}=e,{iString:i}=(0,P.M1)(),[o,s]=(0,a.eJ)(!1),l=(0,k.SVA)(t),c={utm_source:M.b3.navbar,utm_medium:M.lP.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},d=(0,k.n1t)(l,c),u=async()=>{(0,I.j)(I.FP.PUBLICATION_SHARE_BUTTON_CLICKED)},m=(0,r.tZ)(S.hU,{"aria-label":i("Share Publication"),priority:"tertiary",children:(0,r.tZ)(_.Z,{size:20})});return(0,r.BX)(r.HY,{children:[(0,r.BX)(B.M,{trigger:m,onOpen:u,layerOptions:{placement:"bottom-end",preferX:"left"},className:"dropdownMenu-zWNckK",maxHeight:"fit-content",children:[(0,r.tZ)(B.u,{leading:(0,r.tZ)(h.Z,{}),onClick:()=>{(0,C.Ui)({shareUrl:d,pub:t,utm_campaign:M.VX.navbar})},children:i("Copy link")}),(0,r.tZ)(B.u,{leading:(0,r.tZ)(g.Z,{}),onClick:()=>{(0,C.WZ)({shareUrl:d,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:M.VX.navbar})},children:i("Send as email")}),(0,r.tZ)(B.u,{leading:(0,r.tZ)(v.Z,{}),onClick:()=>{(0,I.j)(I.FP.SHARE_PUBLICATION_MODAL_OPENED),s(!0)},children:i("Get shareable images")}),(0,r.BX)(N.xw,{children:[(0,r.tZ)(B.u,{leading:(0,r.tZ)(Z.Z,{}),onClick:()=>{(0,C.BZ)({shareUrl:d,pub:t,utm_campaign:M.VX.navbar})},children:i("Share to Notes")}),(0,r.tZ)(B.u,{leading:(0,r.tZ)(b.Z,{}),onClick:()=>{(0,C.Po)({shareUrl:d,pub:t,utm_campaign:M.VX.navbar})},children:i("Share to Facebook")}),(0,r.tZ)(B.u,{leading:(0,r.tZ)(f.Z,{}),onClick:()=>{(0,C.lc)({shareUrl:d,pub:t,utm_campaign:M.VX.navbar})},children:i("Share to Linkedin")}),(0,r.tZ)(B.u,{leading:(0,r.tZ)(y.Z,{}),onClick:()=>{(0,C.bI)({shareUrl:d,shareName:t.name,pub:t,utm_campaign:M.VX.navbar})},children:i("Share to Bluesky")}),(0,r.tZ)(B.u,{leading:(0,r.tZ)(w.Z,{}),onClick:()=>{(0,C.Wn)({shareUrl:d,shareName:t.name,pub:t,utm_campaign:M.VX.navbar})},children:i("Share to X")})]})]}),(0,r.tZ)(x.iL,{pub:t,isOpen:o,setOpen:s,item:{type:"pub_shareable_image"},width:718})]})}var R=n(33804),F=n(347),E=n(12757),X=n(57391),L=n(36848),T=n(39648),D=n(56629),z=n(40647),U=n(65205),O=n(34552),q=n(98914),j=n(98422),V=n(80026),W=n(19081),H=n(38841),K=n(78096),J=n(70379),G=n(87077),Y=n(91684),$=n(74583),Q=n(98012),ee=n(24791),et=n(6070),en=n(67914),ei=n(60308),eo=n(26111),er=n(84864);let ea=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:i}=(0,j.v9)(),{iString:o}=(0,P.M1)();return(0,r.tZ)(K.gd,{priority:"secondary",size:i?"sm":"md",menuItems:n.map(e=>{let{logo_url:n,name:i,subdomain:o}=e;return(0,r.tZ)(B.u,{href:(0,ei.c0Q)(o,{params:{utm_source:M.b3.substack,utm_content:M.fZ.dashboardPubSwitcher}}),leading:(0,r.tZ)(H.wk,{size:24,radius:"xs",logoUrl:n}),priority:t.subdomain===o?"selected":"primary",children:i})}),href:(0,k.QK7)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:o("Dashboard")})};function es(){let{iString:e}=(0,P.M1)(),t=(0,T.O4)();return(0,r.tZ)(G.u,{text:e("Search"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:G.$$},children:(0,r.tZ)(V.hU,{priority:"tertiary",onClick:()=>t.open(),children:(0,r.tZ)(u.Z,{size:20})})})}let el=e=>{let{dashboardPubs:t,pub:n}=e,{iString:i}=(0,P.M1)(),{isMobile:o}=(0,j.v9)();return t.length>1?(0,r.tZ)(ea,{pub:n,dashboardPubs:t}):(0,r.tZ)(V.zx,{size:o?"sm":"md",priority:"secondary",href:(0,k.QK7)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:i("Dashboard")})},ec=e=>{let{className:t,fixedTooltip:n=!0,freeSignup:s,freeSignupEmail:c,hideCta:u,hideNotifications:m,hideChat:_,hideSearch:h,hideShare:g,hideUserIndicator:v,hide_subscribe_cta:y,isAccountContext:b=!1,isMeetingsActive:f,hasViralGiftsCount:Z,pub:w,showCustomerSupportModeModal:C,user:x}=e,{iString:S,language:N}=(0,P.M1)(),{isMobile:B}=(0,j.v9)(),{getSettingFor:T}=(0,D.So)(),H=(0,X.jc)(),[K,G]=(0,a.eJ)(!1),[ea,ec]=(0,a.eJ)(!1),ed=(0,J.pm)(),{enableCustomerServiceMode:eu,disableCustomerServiceMode:em,modalElement:ep}=(0,O.Vc)({showCustomerSupportModeModal:C}),e_=async()=>{G(!0);try{await p().post("/api/v1/subscription/reactivate").send({}),ec(!0),ed.popToast(e=>(0,r.tZ)(J.FN,(0,o._)((0,i._)({},e),{text:S("Your subscription has been renewed!")})))}catch(e){console.error("Failed to set to renew:",e),alert((0,q.zx)(e))}finally{G(!1)}},eh=b?R.w:F.h;return(0,r.tZ)(W.gq,{alignItems:"center",gap:B?4:8,className:l()("navbar-buttons",t),justifyContent:"end",children:(0,r.BX)(eh,{children:[(0,r.tZ)(z.QA.Consumer,{children:e=>(0,r.tZ)(L.RD.Consumer,{children:t=>(0,r.BX)(r.HY,{children:[!B&&!x&&(0,r.BX)(W.gq,{gap:4,children:[!h&&(0,r.tZ)(es,{}),!g&&(0,r.tZ)(A,{pub:w,user:null!=x?x:void 0})]}),!B&&x&&(0,r.BX)(W.gq,{gap:4,children:[!h&&(0,r.tZ)(es,{}),_?!g&&(0,r.tZ)(A,{pub:w,user:x}):(0,r.tZ)(Y.b,{}),!m&&(0,r.tZ)($.f,{canShowAlerts:!w})]}),!u&&function(e){var t,n,i,o,a,s,l,c,u,m,_;let{user:h,pub:g,freeSignup:v,freeSignupEmail:y,hide_subscribe_cta:b,isMeetingsActive:f,hasViralGiftsCount:Z,siteConfigContext:w,getSettingFor:C,experimentApi:{exposeExperiment:x,getExperimentVariant:P},renewing:S,renewed:N,setToRenew:B,language:A,isMobile:R}=e,{iString:F,iPlural:E}=I18N.i(A);g.invite_only&&!((null==h?void 0:h.subscription_id)||(null==h?void 0:h.is_free_subscribed))&&(b=!0);let X=null==h?void 0:h.is_contributor,L=(null==h?void 0:h.is_subscribed)||X,T=(null==h?void 0:h.is_free_subscribed)||v,D=ee.oH(g)&&L&&["gift","comp"].includes(null!==(o=h.subscription_type)&&void 0!==o?o:"")&&!(0,en.B9)({pub:g,subscriptionType:null==h?void 0:h.subscription_type})&&(0,Q.Z)(h.subscription_expiry).subtract(30,"days").isBeforeNow(),z=ee.oH(g)&&h&&ee.po(h)&&h.comp_expired_recently,O=(null==h?void 0:h.is_free_subscribed)&&(null==h?void 0:h.is_paused),j=(null==h?void 0:h.subscription_type)==="ios_app";if(X){let e=(null==h?void 0:h.dashboard_pubs)||[];return(0,r.tZ)(el,{dashboardPubs:e,pub:g})}if(O)return(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,q.uX)((0,ei.BhD)(g,{addBase:!0}),{local_navigation:!1})},children:F("Unpause my subscription")});if(D||z){if(!b)return(0,r.BX)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{var e;(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,q.uX)((0,ei.W1P)(g,{utm_source:M.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eo.x)("referring_pub_ids"),addBase:!0,selectedPlanId:D&&(null==h?void 0:h.is_founding)&&g.plans?null===(e=g.plans.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===e?void 0:e.id:null}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:F("Subscribe")}),(0,r.tZ)("span",{className:"desktop-only",children:F("Continue your support")})]})}else if(ee.oH(g)&&T&&!L&&!["thebulwark"].includes(g.subdomain)){if(!b)return(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,q.uX)((0,ei.W1P)(g,{utm_source:M.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eo.x)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,er.getSubscribeText)(g,{isFreeSubscribed:!0,isMobile:(0,q.K1)(),language:A})})}else if(ee.oH(g)?L:T||L){if(g.invite_only&&L&&!d()(h.invites)&&h.invites<g.subscriber_invites)return(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,q.uX)((0,ei.UzE)(g),{local_navigation:!1})},children:(0,r.tZ)("span",{children:E("1 invite left","%1 invites left",g.subscriber_invites-h.invites)})});if(ee.oH(g)&&f&&w&&!w.getConfigFor("hide_book_a_meeting_button"))return(0,r.BX)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,q.uX)((0,k.szv)(g,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:F("Book meeting")}),(0,r.tZ)("span",{className:"desktop-only",children:F("Book a meeting")})]});else if(ee.oH(g)&&h&&h.is_subscribed&&!j&&h.subscription_unsubscribed_at&&!["gift","comp"].includes(null!==(a=h.subscription_type)&&void 0!==a?a:""))return(0,r.BX)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"renew"}),B()},disabled:S||N,style:{visibility:N?"hidden":"visible"},children:[(0,r.tZ)("span",{className:"mobile-only",children:F("Renew")}),(0,r.tZ)("span",{className:"desktop-only",children:F("Renew subscription")})]})}else if(!b){let e=null===(c=(0,eo.x)("referring_pub_ids"))||void 0===c?void 0:null===(l=c.split)||void 0===l?void 0:null===(s=l.call(c,","))||void 0===s?void 0:s[0],t=null===(_=(0,eo.x)("referring_pub_ids"))||void 0===_?void 0:null===(m=_.split)||void 0===m?void 0:null===(u=m.call(_,","))||void 0===u?void 0:u.slice(1);return(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:async()=>{let n=h&&!h.is_magic&&h.email||y;if((0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:g.homepage_type}),n){let i;try{i=(await p().post("/api/v1/free").send({source:"menu",email:n,first_url:U.xY,first_referrer:U.ip,current_url:U.UE,current_referrer:U.xU,first_session_url:U.ac,first_session_referrer:U.qR,referring_pub_id:e,additional_referring_pub_ids:t})).body.referral_token,(0,I.IU)()}catch(e){(0,I.j)(I.FP.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,ei.W1P)(g,{utm_source:M.b3.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:i})}else window.location.href=(0,ei.W1P)(g,{utm_source:M.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eo.x)("referring_pub_ids"),addBase:!0})},children:(0,er.getSubscribeText)(g,{isFreeSubscribed:T,isMobile:(0,q.K1)(),language:A})})}if(ee.oH(g)&&h&&h.is_subscribed&&Z){let e=(0,k.xdn)({pub:g,params:{utm_source:M.b3.menu}}),t=P("viral_gift_nav_bar_cta");if(x("viral_gift_nav_bar_cta"),["treatment_send","treatment_left"].includes(null!=t?t:"control")){let n="treatment_send"===t?F(Z>1?"Send free gifts":"Send free gift"):E("1 gift left","%1 gifts left",Z);return(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"send-viral-gift"}),(0,q.uX)(e,{local_navigation:!1})},children:n})}}if(ee.oH(g)&&h&&!h.is_founding&&!j&&(0,Q.Z)(h.subscription_first_payment_at).isBefore((0,Q.Z)().subtract(48,"hours"))&&((0,et.VL)({pub:g})||"pinespayments"===g.subdomain||(null==g?void 0:null===(i=g.plans)||void 0===i?void 0:null===(n=i.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===n?void 0:null===(t=n.metadata)||void 0===t?void 0:t.short_description)==="Founding Member")){let e=(0,k.yRy)({pub:g,user:h,params:{utm_source:M.b3.menu,next:document.location.href}});return(0,r.BX)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,q.uX)(e,{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:F("Upgrade")}),(0,r.tZ)("span",{className:"desktop-only",children:F("Upgrade to founding")})]})}return"disabled"===g.payments_state&&!g.invite_only&&C("payment_pledges_enabled")&&T&&!(null==h?void 0:h.is_pledged)?(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,q.uX)((0,ei.W1P)(g,{utm_source:M.b3.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:F("Pledge your support")}):ee.oH(g)&&!g.invite_only?(0,r.BX)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,q.uX)((0,et.HD)({pub:g})&&h&&(null==w?void 0:w.getConfigFor("enable_founding_gifts"))?(0,et.Iv)({user:h}):(0,ei.W1P)(g,{utm_source:M.b3.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:F("Give gift")}),(0,r.tZ)("span",{className:"desktop-only",children:F("Gift a subscription")})]}):!g.is_on_substack||(null==h?void 0:h.has_publication)?null:(0,r.tZ)(V.zx,{"data-testid":"noncontributor-cta-button",size:R?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,q.uX)((0,ei._HV)({utm_source:M.b3.menu}),{local_navigation:!1})},children:F("Start publishing")})}({pub:w,user:x,freeSignup:s,freeSignupEmail:c,hide_subscribe_cta:y,viralGiftsConfig:w.viralGiftsConfig,localeContext:t,siteConfigContext:e,isMeetingsActive:f,hasViralGiftsCount:Z,getSettingFor:T,experimentApi:H,renewing:K,renewed:ea,setToRenew:e_,language:N,isMobile:B}),!v&&(0,r.tZ)(E.Co,{pub:w,user:x,enableCustomerServiceMode:eu,disableCustomerServiceMode:em,fixedTooltip:n})]})})}),ep]})})}},89810:function(e,t,n){n.d(t,{i:()=>S});var i=n(7409),o=n(99282),r=n(16584),a=n(30396),s=n(39693),l=n.n(s),c=n(24350),d=n.n(c),u=n(80569),m=n.n(u),p=n(21061),_=n(73207),h=n(98130),g=n(94778),v=n(95441),y=n(14952),b=n(60807),f=n(7882),Z=n(98914),w=n(70379),C=n(24791),x=n(6070),P=n(67914),I=n(60308);let S=()=>{let e=(0,b.aF)(),t=(0,y.Ij)(),n=(0,w.pm)(),{iString:s}=(0,v.M1)(),[c,u]=(0,a.eJ)((null==e?void 0:e.name)||""),[S,N]=(0,a.eJ)((null==e?void 0:e.email)||""),[B,k]=(0,a.eJ)(!1),[M,A]=(0,a.eJ)(!1),[R,F]=(0,a.eJ)(null),[E,X]=(0,a.eJ)(null),[L,T]=(0,a.eJ)(!1),[D,z]=(0,a.eJ)(!1),[U]=(0,a.eJ)(0),[O,q]=(0,a.eJ)(new Set),{ids:j}=(0,_.I)({pub:t}),{ids:V}=(0,_.I)({pub:t,pubSetting:"fp_primary_column_section_ids"}),{ids:W}=(0,g.c)({pub:null!=t?t:void 0}),{ids:H}=(0,h.L)({pub:null!=t?t:void 0}),{ids:K}=(0,p.l)({pub:null!=t?t:void 0}),{result:J,isLoading:G,refetch:Y}=(0,f.ib)({pathname:"/api/v1/subscription",auto:!0}),{refetch:$,isLoading:Q}=(0,f.ib)({pathname:"/api/v1/subscription/sections/email",auto:!1,method:"PATCH"}),{refetch:ee}=(0,f.ib)({pathname:"/api/v1/subscription/email",auto:!1,method:"POST"});(0,a.d4)(()=>{!G&&(null==J?void 0:J.email_settings)&&q(new Set(Object.keys(J.email_settings).filter(e=>{var t;return"individual"===(null===(t=J.email_settings)||void 0===t?void 0:t[e])}).map(e=>Number(e))))},[G,J]);let et=(0,a.I4)(async e=>{if(e&&e!==c){k(!0),F(null);try{await m().put("/api/v1/user/profile").send({name:e}),u(e)}catch(e){F((0,Z.zx)(e)),console.error("Name update failed:",e)}finally{k(!1)}}},[c]),en=(0,a.I4)(async()=>{if(!(null==e?void 0:e.email))return{success:!1};T(!0);try{return await m().post("/api/v1/forgot").send({email:e.email,for_pub:null==t?void 0:t.subdomain,redirect:window.location.pathname}),n.popToast(e=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},e),{text:"Password reset email sent. Please check your inbox."}))),{success:!0}}catch(e){return console.error("Password reset failed:",e),n.popToast(t=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},t),{text:(0,Z.zx)(e)}))),{success:!1}}finally{T(!1)}},[null==e?void 0:e.email,n]),ei=(0,a.I4)(async(e,n)=>{if(e&&e!==S){if(e!==n){X("Email addresses do not match");return}A(!0),X(null);try{await m().put("/api/v1/user/email").send({email:e,email_doublecheck:n}),N(e),(0,Z.uX)((0,I.ZPN)({redirect:"/subscribe?isSignInAttempt=true",for_pub:null==t?void 0:t.subdomain}))}catch(e){var i;(null===(i=e.response)||void 0===i?void 0:i.status)===403?X("This email is already associated with another account"):X((0,Z.zx)(e)),console.error("Email update failed:",e)}finally{A(!1)}}},[S]),eo=(0,a.Ye)(()=>t?(0,C.tk)({pub:t,includeMainPub:!(0,x.HD)({pub:t}),excludePodcasts:(0,x.HD)({pub:t})}):[],[t]),er=(0,a.Ye)(()=>eo.filter(e=>{var t,n,i;return!W.includes(null!==(t=e.sectionId)&&void 0!==t?t:-1)&&!H.includes(null!==(n=e.sectionId)&&void 0!==n?n:-1)&&!K.includes(null!==(i=e.sectionId)&&void 0!==i?i:-1)}),[eo,W,H,K]),ea=(0,a.I4)(async(e,n)=>{if(!e||!t)return;let i=new Set(O);n?i.add(e):i.delete(e);try{await $({json:er.reduce((t,i)=>(i.sectionId===e&&(t[i.sectionId]={setting:n?"individual":"disabled"}),t),{})}),n&&(null==J?void 0:J.email_disabled)&&(await ee({json:{publication_id:t.id,email_disabled:!1,receive_podcast_emails:!0,source:"account_settings"}}),await Y()),q(i)}catch(e){console.error("Failed to update newsletter subscription:",e)}},[t,O,er,$,ee,J,Y]),es=(0,a.I4)(async(e,n)=>{if(!t)return;let i=[];"fromTheFreePress"===e?i=V:"featured"===e?i=j.filter(e=>!V.includes(e)):"topic"===e&&(i=er.filter(e=>!V.includes(e.sectionId||0)&&!j.includes(e.sectionId||0)).map(e=>e.sectionId||0));let o=new Set(O);i.forEach(e=>{n?o.add(e):o.delete(e)});try{let e=i.reduce((e,t)=>(e[t]={setting:n?"individual":"disabled"},e),{});await $({json:e}),n&&(null==J?void 0:J.email_disabled)&&(await ee({json:{publication_id:t.id,email_disabled:!1,receive_podcast_emails:!0,source:"account_settings"}}),await Y()),q(o)}catch(e){console.error("Failed to update newsletter group:",e)}},[t,V,j,O,$,ee,J,Y]),el=(0,a.I4)(async()=>{if(t&&e)try{let e=er.filter(e=>e.sectionId).map(e=>e.sectionId);if(e.length>0){let t=e.reduce((e,t)=>(e[t]={setting:"disabled"},e),{});await $({json:t})}await ee({json:{publication_id:t.id,email_disabled:!0,receive_podcast_emails:!1,source:"account_settings"}}),await Y(),q(new Set),n.popToast(e=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},e),{text:"Successfully unsubscribed from all emails."})))}catch(e){console.error("Failed to unsubscribe from all emails:",e),n.popToast(t=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},t),{text:(0,Z.zx)(e)})))}},[t,e,er,$,ee,Y,n]),ec=(0,a.I4)(async()=>{if(confirm(s("Are you sure? Time paid will not be refunded")))try{await m().del("/api/v1/subscription").send({force_now:!0}),n.popToast(e=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},e),{text:"Subscription cancelled successfully."}))),setTimeout(()=>{window.location.reload()},1e3)}catch(e){console.error("Failed to delete subscription:",e),n.popToast(t=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},t),{text:(0,Z.zx)(e)})))}},[s,n]),ed=(0,a.I4)(async()=>{z(!0);try{await m().post("/api/v1/subscription/reactivate").send({}),n.popToast(e=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},e),{text:"Your subscription is set to renew."}))),await Y()}catch(e){console.error("Failed to set to renew:",e),n.popToast(t=>(0,r.tZ)(w.FN,(0,o._)((0,i._)({},t),{text:(0,Z.zx)(e)})))}finally{z(!1)}},[n,Y]),eu=d()(er,"sectionId"),em=t&&V?{name:"From The Free Press",newsletters:l()(V.map(e=>eu[e])).map(e=>(0,o._)((0,i._)({},e),{selected:O.has(e.sectionId||0),onToggle:t=>ea(e.sectionId||0,t)}))}:{name:"From The Free Press",newsletters:[]},ep=t&&V?{name:"All",newsletters:l()(er.filter(e=>e.sectionId).map(e=>(0,o._)((0,i._)({},e),{selected:O.has(e.sectionId||0),onToggle:t=>ea(e.sectionId||0,t)})))}:{name:"All",newsletters:[]},e_=t&&j?{name:"Featured",newsletters:l()(j.filter(e=>!V.includes(e)).map(e=>eu[e])).map(e=>(0,o._)((0,i._)({},e),{selected:O.has(e.sectionId||0),onToggle:t=>ea(e.sectionId||0,t)}))}:{name:"Featured",newsletters:[]},eh=t&&er?{name:"Topic Alerts",newsletters:l()(er.filter(e=>!!e.sectionId&&!V.includes(e.sectionId)&&!j.includes(e.sectionId)).map(e=>(0,o._)((0,i._)({},e),{selected:O.has(e.sectionId||0),onToggle:t=>ea(e.sectionId||0,t)})))}:{name:"Topic Alerts",newsletters:[]},eg=(null==J?void 0:J.status)==="trialing",ev=null;return eg&&(J.current_period_end?ev=new Date(1e3*J.current_period_end):J.expiry&&(ev=new Date(J.expiry))),{name:c,email:S,updateName:et,updateEmail:ei,isUpdatingName:B,isUpdatingEmail:M,nameError:R,emailError:E,isSendingReset:L,handlePasswordChange:en,newsletters:{isLoading:G||Q,fromTheFreePress:em,all:ep,featured:e_,topic:eh,updateNewsletter:ea,updateNewsletterGroup:es,unsubscribeFromAllEmails:el,pubEmailsDisabled:!!(null==J?void 0:J.email_disabled)},plan:null==J?void 0:J.plan,totalAmount:null==J?void 0:J.totalAmount,currency:null==J?void 0:J.currency,isLifetime:(null==J?void 0:J.type)==="lifetime"||(null==J?void 0:J.never_ends)||!1,isComped:(null==J?void 0:J.is_comped)||!1,isTrial:eg,giftCount:U,trialEnd:ev,canChangeSubscription:!!J&&(0,P.Nf)(J),subscription:null!=J?J:void 0,renewing:D,onSetToRenew:ed,onUnsubscribeNow:ec}}},34288:function(e,t,n){n.d(t,{$:()=>y});var i=n(16584),o=n(98661);n(30396);var r=n(94184),a=n.n(r),s=n(95031),l=n(55438);n(97742);var c=n(58319),d=n(95441),u=n(45261),m=n(68833),p=n(58175),_=n(60308);n(6911);var h=n(81821),g=n(47929),v=n(8525);let y=(0,o.memo)(e=>{let{publication:t,user:n,path:o,hideTerms:r,showIntrinioAttrib:y}=e,{iString:b}=(0,d.M1)();void 0===r&&(r=!1);let f=(0,u.Tf)(),Z=(0,h.tq)(),w=(0,h.s)(),C=(0,h.Dt)(),x=n&&!n.reader_installed_at,P=Z&&(w||C)&&x;return(0,i.BX)("div",{className:"footer-wrap publication-footer",children:[(0,i.tZ)(c.Z,{onVisible:()=>{var e;(0,m.j)(m.FP.PUBLICATION_FOOTER_SEEN,{publication_id:null==t?void 0:t.id,user_id:null==n?void 0:n.id,source:(e=o)?"/"===e?"pub-homepage":e.startsWith("/p")?"pub-post":e:"unknown"})}}),(0,i.tZ)("div",{className:a()("footer",{"themed-background":f}),children:(0,i.BX)("div",{className:"container",children:[(0,i.tZ)(s._,{hideTerms:r,pub:t,showIntrinioAttrib:null!=y&&y}),(0,i.BX)("div",{className:"footer-buttons",children:[(0,i.BX)("a",{className:a()("footer-substack-cta","start-publishing",P&&"app-upsell"),native:!0,href:(null==n?void 0:n.has_publication)?"".concat((0,_.SVA)({subdomain:"your"}),"/publish"):"".concat((0,_.ZJn)(),"/signup?").concat((0,_.Y$Q)({utm_source:g.b3.substack,utm_medium:g.lP.web,utm_content:g.fZ.footer})),children:[(0,i.tZ)(l.Z,{})," ",b("Start writing")]}),!P&&(0,i.tZ)("a",{className:"footer-substack-cta get-the-app no-icon",native:!0,href:(0,_.D4e)({utm_campaign:g.VX.appMarketing,utm_content:g.fZ.webFooterButton}),children:b("Get the app")}),P&&w&&(0,i.tZ)("a",{className:v.Z.appBadge,href:(0,_.D4e)({utm_campaign:g.VX.appMarketing,utm_content:g.fZ.webFooterButton,force:"ios"}),children:(0,i.tZ)("img",{className:"app-upsell",src:(0,_.zF4)("/img/app_page/app-store.png",320)})}),P&&C&&(0,i.tZ)("a",{className:v.Z.appBadge,href:(0,_.D4e)({utm_campaign:g.VX.appMarketing,utm_content:g.fZ.webFooterButton,force:"android"}),children:(0,i.tZ)("img",{className:"app-upsell",src:(0,_.zF4)("/img/app_page/google-play.png",320)})})]}),(0,i.BX)(p.xv,{translated:!0,as:"div",className:"footer-slogan-blurb",children:[(0,i.tZ)("a",{href:"".concat((0,_.ZJn)()),native:!0,children:"Substack"})," ","is the home for great culture"]})]})})]})})},13561:function(e,t,n){n.d(t,{A:()=>v});var i=n(16584),o=n(6400),r=n(19425),a=n(79403),s=n(94184),l=n.n(s),c=n(50308),d=n.n(c),u=n(71375),m=n(347),p=n(15771),_=n(19081),h=n(27190),g=n(88e3);let v=e=>{let{children:t,disableCloseOnBackdropClick:n=!1,fullscreenMobile:s,hideCloseButton:c,initialFocus:v,isOpen:y,maxFullscreenMobile:b,overflow:f,testId:Z="modal",width:w=660,onClose:C=()=>void 0,onEscape:x}=e;return(0,i.tZ)(m.h,{children:(0,i.tZ)(r.u,{as:o.Fragment,show:y,children:(0,i.tZ)(a.V,{as:"div",className:"modal-Suw4en","data-testid":Z,initialFocus:v,onClick:e=>e.stopPropagation(),onClose:n?d():C,onKeyDown:x?e=>{let{code:t}=e;x&&"Escape"===t&&x(e)}:void 0,onMouseDown:e=>e.stopPropagation(),onMouseUp:e=>e.stopPropagation(),children:(0,i.BX)(h.Uv,{children:[(0,i.tZ)(h.sc,{children:(0,i.tZ)(h._n,{})}),(0,i.tZ)(g.Q,{children:(0,i.tZ)(g.l,{className:l()("modalBody-s4SL_V","the-free-press-theme"),fullscreenMobile:s,maxFullscreenMobile:b,overflow:f,width:w,children:(0,i.tZ)(m.h,{children:(0,i.BX)(_.tu,{paddingTop:c?24:8,children:[!c&&(0,i.tZ)(_.gq,{justifyContent:"end",children:(0,i.tZ)(p.hU,{priority:"quaternary",onClick:C,children:(0,i.tZ)(u.Z,{})})}),t]})})})})]})})})})}},12757:function(e,t,n){n.d(t,{Co:()=>z});var i=n(7409),o=n(99282),r=n(98848),a=n(16584),s=n(94184),l=n.n(s),c=n(66120),d=n(24840),u=n(43061),m=n(84488),p=n(98661),_=n(86374),h=n(83320),g=n(87698),v=n(89320),y=n(9997),b=n(78327);let f=(0,n(6400).createContext)(!1);var Z=n(95441),w=n(36518),C=n(68833),x=n(43251),P=n(98422),I=n(94874),S=n(17540),N=n(15771),B=n(19081),k=n(36500),M=n(84747),A=n(58175),R=n(60308),F=n(6911),E=n(63651),X=n(47929),L=n(75983);let T=X.b3.userMenu,D="https://support.substack.com/hc/en-us/?utm_source=".concat(T);function z(e){var{user:t,pub:n}=e,s=(0,r._)(e,["user","pub"]);let{iString:c}=(0,Z.M1)(),d=(0,p.useContext)(f),{isMobile:u}=(0,P.v9)();return(0,a.tZ)(a.HY,{children:t?(0,a.tZ)(U,(0,o._)((0,i._)({},s),{user:t,pub:n})):(0,a.tZ)(N.zx,{href:(0,R.uXE)({for_pub:null==n?void 0:n.subdomain}),priority:"tertiary",size:u?"sm":"md",className:l()({"force-desktop":d}),native:!0,children:c("Sign in")})})}function U(e){var{user:t}=e,n=(0,r._)(e,["user"]);let{isMobile:s}=(0,P.v9)(),l=s||!t.photo_url?(0,a.tZ)(N.hU,{priority:"tertiary",size:"sm",children:(0,a.tZ)(c.Z,{size:20})}):(0,a.tZ)(O,{user:t});return(0,a.tZ)(q,(0,o._)((0,i._)({},n),{user:t,trigger:l}))}let O=(0,p.forwardRef)((e,t)=>{var{user:n}=e,s=(0,r._)(e,["user"]);let{isMobile:l}=(0,P.v9)();return(0,a.tZ)(N.kG,(0,o._)((0,i._)({},s),{resetCss:!0,position:"relative",className:L.Z.avatarButton,showFocus:!0,animate:!0,radius:"full",ref:t,children:(0,a.tZ)(S.Ct,{priority:"secondary",theme:"default",fillIcon:!0,placement:"bottom-right",content:(0,a.tZ)(_.Z,{size:14}),children:(0,a.tZ)(I.qE,{user:n,size:l?32:40,"aria-hidden":!0})})}))});function q(e){let{trigger:t,user:n,pub:i,enableCustomerServiceMode:o,disableCustomerServiceMode:r,freeSignup:s}=e,{iString:l}=(0,Z.M1)(),{activityUnreadCount:c}=(0,w.lR)(),u=e=>()=>{(0,C.j)(e)};return(0,a.BX)(M.M,{trigger:t,onOpen:()=>(0,C.j)(C.FP.USER_MENU_OPENED),onClose:()=>(0,C.j)(C.FP.USER_MENU_DISMISSED),className:L.Z.dropdown,ariaLabel:l("More options"),children:[(0,a.tZ)(j,{user:n}),(0,a.BX)(k.xw,{children:[(0,a.tZ)(M.u,{href:(0,R.E2n)({urlParams:{utm_source:T}}),onClick:u(C.FP.USER_MENU_FEED_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(v.Z,{size:20})}),native:!0,children:l("Home")}),(0,a.tZ)(M.u,{href:(0,R.HMK)({utm_source:T}),onClick:u(C.FP.USER_MENU_READER_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(y.Z,{size:20})}),native:!0,children:l("Subscriptions")}),(0,a.tZ)(M.u,{href:(0,E.Cnj)(),onClick:u(C.FP.USER_MENU_CHAT_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(g.Z,{size:20})}),native:!0,children:l("Chat")}),(0,a.tZ)(M.u,{href:(0,R.Fu$)({utm_source:T}),onClick:u(C.FP.USER_MENU_ACTIVITY_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(h.Z,{size:20})}),native:!0,children:(0,a.BX)(B.hs,{flex:"grow",justifyContent:"space-between",children:[l("Activity"),c>0&&(0,a.tZ)(b.V,{className:"indicator-badge",count:c})]})}),(0,a.tZ)(M.u,{href:(0,R._P8)(),onClick:u(C.FP.USER_MENU_DISCOVER_CLICKED),leading:(0,a.tZ)(B.M5,{width:20,height:20,children:(0,a.tZ)(d.Z,{size:16,strokeWidth:2})}),native:!0,children:l("Explore")})]}),(0,a.tZ)(V,{freeSignup:null!=s&&s,pub:null!=i?i:null,user:n}),(0,a.tZ)(W,{pub:null!=i?i:null}),!n.reader_installed_at&&(0,a.tZ)(k.xw,{children:(0,a.tZ)(M.u,{href:(0,R.tSX)({utm_campaign:X.VX.appMarketing,utm_content:X.fZ.userMenuLink}),priority:"accent",native:!0,children:l("Get the app")})}),(0,a.tZ)(H,{enableCustomerServiceMode:o,disableCustomerServiceMode:r,pub:null!=i?i:null,user:n}),(0,a.tZ)(K,{pub:null!=i?i:null})]})}let j=e=>{let{user:t}=e,{iString:n}=(0,Z.M1)(),i=(0,x.Lw)(t,{utm_source:T}),o="",r="";return t&&(o=(null==t?void 0:t.profile_set_up_at)&&t.name?t.name:t.email,r=(null==t?void 0:t.profile_set_up_at)?t.handle?"@".concat(t.handle):null:n("Set up your profile")),(0,a.tZ)(M.u,{href:i,onClick:()=>(0,C.j)(C.FP.USER_MENU_PROFILE_CLICKED),native:!0,children:(0,a.BX)(B.hs,{gap:12,alignItems:"center",children:[(0,a.tZ)(I.qE,{size:40,user:null!=t?t:void 0,"aria-hidden":!0}),(0,a.BX)(B.tu,{flex:"grow",children:[(0,a.tZ)(A.xv.B4,{weight:"semibold",children:o}),r&&(0,a.tZ)(A.xv.B4,{color:"secondary",children:r})]})]})})},V=e=>{let{freeSignup:t,user:n,pub:i}=e,{iString:o}=(0,Z.M1)(),r=i&&(t||n&&(n.is_subscribed||n.is_free_subscribed)),s=!!(null==n?void 0:n.subdomain);return s||r?(0,a.BX)(k.xw,{children:[r&&(0,a.tZ)(M.u,{href:(0,R.n1t)("/account",{utm_source:T}),onClick:()=>(0,C.j)(C.FP.USER_MENU_MANAGE_SUBSCRIPTION_CLICKED),priority:"secondary",native:!0,children:o("Manage subscription")}),s&&n.subdomain&&(0,a.tZ)(M.u,{priority:"secondary",href:(0,R.c0Q)(n.subdomain,{params:{utm_source:X.b3.substack}}),native:!0,trailing:(0,a.tZ)(u.Z,{}),children:o("Dashboard")})]}):null},W=e=>{let{pub:t}=e,{iString:n}=(0,Z.M1)();return(0,a.BX)(k.xw,{children:[(0,a.tZ)(M.u,{href:(0,R.v3t)({utm_source:T}),onClick:()=>(0,C.j)(C.FP.USER_MENU_ACCOUNT_SETTINGS_CLICKED),priority:"secondary",native:!0,children:n("Settings")}),(0,a.tZ)(M.u,{href:D,priority:"secondary",children:n("Support")}),(0,a.tZ)(M.u,{href:(0,R.ZPN)({utm_source:T,for_pub:null==t?void 0:t.subdomain}),priority:"secondary",native:!0,children:n("Sign out")})]})},H=e=>{let{disableCustomerServiceMode:t,enableCustomerServiceMode:n,pub:i,user:o}=e;return(null==o?void 0:o.is_global_admin)&&(n||t)?(0,a.BX)(k.xw,{children:[n&&(0,a.tZ)(M.u,{priority:"secondary",onClick:n,trailing:(0,a.tZ)(m.Z,{}),native:!0,children:"Enter support mode"}),t&&(0,a.tZ)(M.u,{priority:"secondary",onClick:t,trailing:(0,a.tZ)(m.Z,{}),native:!0,children:"Exit support mode"}),i&&(0,a.tZ)(M.u,{priority:"secondary",href:"".concat((0,E.SVA)({subdomain:"admin"}),"/publications/").concat(i.id),trailing:(0,a.tZ)(m.Z,{}),native:!0,children:"Open in Underground"})]}):null},K=e=>{let{pub:t}=e,{iString:n}=(0,Z.M1)();return(0,a.tZ)(k.xw,{children:(0,a.tZ)(A.xv.B4,{size:12,color:"secondary",children:(0,a.BX)(B.hs,{gap:12,padding:8,className:"footer",children:[(0,a.tZ)(A.hh,{href:(0,R.cdl)({utm_source:T}),children:n("About")}),(0,a.tZ)(A.hh,{href:(0,F.RF)({pub:t,utm_source:T}),children:n("Privacy")}),(0,a.tZ)(A.hh,{href:(0,F.P8)({pub:t,utm_source:T}),children:n("Terms")}),(0,a.tZ)(A.hh,{href:(0,F.WF)({utm_source:T}),children:n("Data")}),(0,a.tZ)(A.hh,{href:(0,F.ee)({utm_source:T}),children:n("Accessibility")})]})})})}},59480:function(e,t,n){n.d(t,{Uu:()=>l});var i=n(68833);let o=["sort"],r=["sort","selection"],a=[];function s(e,t){let n;try{n=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){n=new URL(e)}for(let e of n.searchParams.keys())(t?r:o).includes(e)||n.searchParams.delete(e);return n.toString()}function l(e){setTimeout(()=>(function(e){var t,n;let{previous:o,url:r}=e;if("undefined"==typeof window)return;let l=s(r,!1),c=s(r,!0),{head:d}=document;null===(t=d.querySelector("link[rel=canonical]"))||void 0===t||t.setAttribute("href",l),null===(n=d.querySelector('meta[property="og:url"]'))||void 0===n||n.setAttribute("content",c),a.push(r),setTimeout(()=>{(0,i.jA)({previous:o,url:r})},100)})(e),0)}},34552:function(e,t,n){n.d(t,{Vc:()=>_});var i=n(16584),o=n(98661),r=n(30218),a=n(93666),s=n(96726),l=n(14952),c=n(60807),d=n(48980),u=n(98914),m=n(60308),p=n(26111);function _(){var e;let{showCustomerSupportModeModal:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,l.Ij)(),_=(0,c.aF)(),{canTurnOnCustomerSupportMode:h,isInCustomerSupportMode:g}={canTurnOnCustomerSupportMode:!!(null==(e=(0,c.aF)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},v=(0,o.useRef)(null),y=async()=>{try{await (0,d.rd)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,u.zx)(e))}},b=async()=>{if(null==n?void 0:n.custom_domain){let e=window.location.pathname;(0,u.uX)((0,m.Q6L)(e,n),{local_navigation:!1})}else{var e;null===(e=v.current)||void 0===e||e.open()}},f=h&&(0,i.tZ)(s.h,{children:(0,i.tZ)(a.p,{className:"account-info-customer-support-mode-modal",ref:v,openByDefault:t&&h,children:(0,i.tZ)(r.Z,{redirect:(0,p.x)("redirect")||"/publish/home",onCancel:e=>{var t;return null===(t=v.current)||void 0===t?void 0:t.close(e)},requiresMfa:null==_?void 0:_.requires_global_admin_mfa_challenge})})});return{enableCustomerServiceMode:h?b:void 0,disableCustomerServiceMode:g?y:void 0,modalElement:f}}},71e3:function(e,t,n){n.d(t,{A:()=>F});var i=n(16584),o=n(94184),r=n.n(o),a=n(30998),s=n.n(a),l=n(89734),c=n.n(l),d=n(55480),u=n(67749),m=n(20888),p=n(95441),_=n(68833),h=n(98422),g=n(71068),v=n(15771),y=n(19081),b=n(58175),f=n(63651);let Z={containerVertical:"containerVertical-L_u6LQ",logoVertical:"logoVertical-p9LsNy",listenLink:"listenLink-UqdzU4"},w=e=>{var t;let{label:n,openInNewTab:o,podcastSettings:a,section:s,sectionUrl:l,setupUrl:c,subscribeUrl:d,trackingSource:w,user:C}=e,{iString:P}=(0,p.M1)(),{isMobile:I}=(0,h.v9)(),S=I?80:160,N=(0,g.oB)({radius:"md",width:S}),B=(null==C?void 0:C.is_subscribed)&&null!==(t=a.paidEpisodeArtUrl)&&void 0!==t?t:a.artUrl;return(0,i.BX)(y.gq,{direction:I?"column":"row",gap:I?12:24,children:[B&&(0,i.tZ)(m.e,{className:r()(N),src:(0,f.zF4)(B,2*S),maxWidth:S,useRetinaSizing:!0,imageIsFixedWidth:!0}),(0,i.BX)(y.tu,{gap:8,children:[(0,i.BX)(y.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,i.tZ)(b.xv.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",weight:"bold",href:l,rel:"noopener noreferrer",target:"_blank",children:a.title}),c&&(0,i.tZ)(v.zx,{priority:"secondary",size:"sm",href:c,newTab:o,onClick:()=>{(0,_.j)(_.FP.SET_UP_FEED_CLICKED,{section_id:s.id,source:w})},children:P("Set up")})]}),n&&(0,i.BX)(y.gq,{gap:8,alignItems:"center",children:[(0,i.tZ)(x,{label:n}),"free-with-ads"===n&&d&&(0,i.tZ)(b.xv,{className:Z.listenLink,color:"accent",font:"text",size:12,onClick:()=>{(0,_.j)(_.FP.LISTEN_AD_FREE_CLICKED,{section_id:s.id,source:w}),o?window.open(d,"_blank","noopener,noreferrer"):window.location.href=d},children:"Listen ad-free"})]}),(0,i.tZ)(b.xv.B3,{color:"pub-secondary-text",font:"text",children:a.description}),(0,i.tZ)("div",{children:(0,i.BX)(b.xv,{alignItems:"center",color:"accent",display:"inline-flex",font:"text",size:14,weight:"medium",gap:8,onClick:()=>{(0,_.j)(_.FP.SEE_ALL_EPISODES_CLICKED,{section_id:s.id,source:w}),o?window.open(l,"_blank","noopener,noreferrer"):window.location.href=l},children:[(0,i.tZ)("span",{children:P("See all episodes")}),(0,i.tZ)(u.Z,{size:14})]})})]})]})},C=e=>{let{label:t,openInNewTab:n,podcastSettings:o,section:a,sectionUrl:s,trackingSource:l}=e,{iString:c}=(0,p.M1)(),d=(0,g.oB)({radius:"md"});return(0,i.BX)(y.tu,{className:Z.containerVertical,border:"detail-themed",padding:20,radius:"md",gap:20,children:[(0,i.tZ)(y.gq,{justifyContent:"center",children:o.artUrl&&(0,i.tZ)(m.e,{className:r()(d,Z.logoVertical),src:(0,f.zF4)(o.artUrl,440),maxWidth:164,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,i.BX)(y.tu,{gap:12,children:[(0,i.BX)(y.tu,{gap:8,children:[(0,i.tZ)(b.xv.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",href:s,rel:"noopener noreferrer",target:"_blank",weight:"bold",children:o.title}),t&&(0,i.tZ)(y.gq,{children:(0,i.tZ)(x,{label:t})}),(0,i.tZ)(b.xv.B3,{color:"pub-secondary-text",font:"text",children:o.description})]}),(0,i.tZ)("div",{children:(0,i.BX)(b.xv,{display:"inline-flex",alignItems:"center",gap:8,color:"accent",font:"text",size:14,weight:"medium",onClick:()=>{(0,_.j)(_.FP.SEE_ALL_EPISODES_CLICKED,{section_id:a.id,source:l}),n?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s},children:[(0,i.tZ)("span",{children:c("See all episodes")}),(0,i.tZ)(u.Z,{size:14})]})})]})]})},x=e=>{let{label:t}=e;return(0,i.tZ)(y.gq,{bg:"secondary",display:"inline-block",paddingX:6,radius:"sm",children:(0,i.tZ)(b.xv,{color:"pub-secondary-text",font:"text",size:12,weight:"semibold",lineHeight:20,children:"member-only"===t?"+ Member-only":"free-with-ads"===t?"Free with ads":"Free"})})};var P=n(46234),I=n(30733),S=n(24791),N=n(6070),B=n(60308),k=n(26111),M=n(47929);let A={twoColumnGrid:"twoColumnGrid-pq1MC7",mainColumn:"mainColumn-cft5kf",sideColumn:"sideColumn-FFh4jo"},R=M.b3.podcastsPage,F=e=>{let{idToMagicLink:t,pub:n,user:o}=e,{isMobile:a}=(0,h.v9)(),l=c()((0,S.hK)(n),e=>{var t;return null!==(t=s()(n.navigationBarItems,t=>t.section_id===e.id))&&void 0!==t?t:999}),u=!!(null==o?void 0:o.is_subscribed),m=!u&&!a,p=l.filter(e=>u||!(0,N.QI)({sectionId:e.id})),_=u?[]:l.filter(e=>(0,N.QI)({sectionId:e.id})),g=null==t?void 0:t[n.id];return g||(g=(0,B.tS3)(n,{section:null,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!o||!o.is_free_subscribed,params:{utm_source:R}})),(0,i.tZ)(I.N,{columns:m?3:2,paddingTop:a?8:void 0,children:(0,i.BX)(y.hs,{className:r()({[A.twoColumnGrid]:m}),direction:m?"row":"column",gap:m?void 0:40,children:[!u&&(0,i.BX)(y.tu,{alignItems:a?"stretch":"start",className:A.sideColumn,gap:24,paddingLeft:m?32:void 0,children:[(0,i.BX)(y.tu,{gap:a?12:16,children:[(0,i.tZ)(b.xv.H2,{color:"pub-primary-text",font:"pub-headings",children:"Member-only Shows"}),(0,i.tZ)(P.B,{firehoseFeedUrl:g,pub:n,trackingSource:R,variant:"member-only"})]}),(0,i.tZ)(y.tu,{gap:a?16:24,children:_.map((e,r)=>{let s=(0,d.d_)({pub:n,section:e}),l=(null==t?void 0:t[e.id])||(0,B.tS3)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!o||!o.is_free_subscribed,params:{utm_source:R}}),c=(0,f.Ucy)(n,{section:e,addBase:!0}),m=(0,N.hx)({sectionId:e.id})?"member-only":"free";return(0,i.BX)(i.HY,{children:[(0,i.tZ)(a?w:C,{label:m,openInNewTab:!0,podcastSettings:s,section:e,sectionUrl:c,setupUrl:u?l:null,trackingSource:R,user:null!=o?o:null}),r!==_.length-1&&a&&(0,i.tZ)(y.gq,{borderBottom:"detail-themed"})]})})})]}),(0,i.BX)(y.tu,{className:A.mainColumn,gap:24,paddingRight:m?32:void 0,children:[(0,i.BX)(y.tu,{gap:a?12:16,children:[(0,i.BX)(b.xv.H2,{color:"pub-primary-text",font:"pub-headings",children:[n.name," Shows"]}),u&&(0,i.tZ)(P.B,{pub:n,firehoseFeedUrl:g,trackingSource:R})]}),(0,i.tZ)(y.tu,{gap:a?16:24,children:p.map((e,r)=>{let a=(0,d.d_)({pub:n,section:e}),s=(null==t?void 0:t[e.id])||(0,B.tS3)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!o||!o.is_free_subscribed,params:{utm_source:R}}),l=(0,f.Ucy)(n,{section:e,addBase:!0}),c=(0,N.hx)({sectionId:e.id})?u?"member-only":"free-with-ads":"free";return(0,i.BX)(i.HY,{children:[(0,i.tZ)(w,{label:c,openInNewTab:!0,podcastSettings:a,section:e,sectionUrl:l,setupUrl:u?s:null,subscribeUrl:(0,B.W1P)(n,{utm_source:R,simple:!0,next:document.location.href,referring_pub_ids:(0,k.x)("referring_pub_ids"),addBase:!0}),trackingSource:R,user:null!=o?o:null}),r!==p.length-1&&(0,i.tZ)(y.gq,{borderBottom:"detail-themed"})]})})})]})]})})}},12844:function(e,t,n){n.d(t,{k:()=>p,w:()=>u});var i=n(16584),o=n(95441),r=n(15771),a=n(17352),s=n(19081),l=n(38841),c=n(58175),d=n(60308);let u=(e,t)=>{var n;return{logoUrl:e.podcast_art_url||e.logo_url||(0,d.cse)(),mainClickUrl:(0,d.UVC)({pub:e,section:null,addBase:!0}),buttonClickUrl:t,name:e.podcast_title||e.name,description:null!==(n=e.podcast_description||e.hero_text)&&void 0!==n?n:void 0}},m=e=>{let{logoUrl:t,mainClickUrl:n,buttonClickUrl:d,name:u,description:m,showButton:p}=e,{iString:_}=(0,o.M1)();return(0,i.BX)(a.Z,{gap:12,direction:"row",alignItems:"center",padding:12,children:[t&&(0,i.tZ)(l.wk,{size:48,logoUrl:t}),(0,i.BX)(s.sg,{gap:2,flex:"grow",children:[(0,i.tZ)(c.xv.B3,{weight:"semibold",children:(0,i.tZ)(c.hh,{href:n,children:u})}),(0,i.tZ)(c.xv.B4,{color:"secondary",children:m})]}),p&&(0,i.tZ)(r.zx,{priority:"primary",href:d,newTab:!0,children:_("Set up")})]})},p=e=>{let{showButton:t,items:n}=e;return(0,i.tZ)(s.sg,{gap:12,children:n.map(e=>(0,i.tZ)(m,{logoUrl:e.logoUrl,mainClickUrl:e.mainClickUrl,buttonClickUrl:e.buttonClickUrl,name:e.name,description:e.description,showButton:t}))})}},39198:function(e,t,n){n.d(t,{t:()=>s});var i=n(16584),o=n(61254),r=n(19081),a=n(58175);function s(e){let{children:t}=e;return(0,i.BX)(i.HY,{children:[(0,i.tZ)(r.tu,{paddingY:4,paddingX:8,children:(0,i.tZ)(a.xv.B4,{color:"secondary",children:t})}),(0,i.tZ)(o.iz,{pullX:8})]})}},96302:function(e,t,n){n.d(t,{ZP:()=>v,rs:()=>_});var i=n(7409),o=n(99282),r=n(98848),a=n(16584),s=n(59278),l=n(94184),c=n.n(l);n(98661);var d=n(95441),u=n(71068);n(58175);var m=n(28657);let p=e=>{var{children:t,size:n}=e,l=(0,r._)(e,["children","size"]);let{iString:c}=(0,d.M1)();return(0,a.tZ)(s.r,(0,o._)((0,i._)({"aria-label":c("Toggle setting")},l),{onClick:e=>{e.stopPropagation()},children:t}))},_=e=>{var{checked:t,disabled:n,size:s="md",theme:l="accent",leading:d,trailing:u}=e,_=(0,r._)(e,["checked","disabled","size","theme","leading","trailing"]);return(0,a.BX)(g,{children:[d&&d,(0,a.tZ)(p,(0,o._)((0,i._)({checked:t,disabled:n,className:c()(m.Z.track,n?m.Z.disabled:m.Z.enabled,t?m.Z.checked:m.Z.unchecked,m.Z[s],m.Z["theme_".concat(l)])},_),{children:(0,a.tZ)(h,{className:c()(m.Z.nub,n?m.Z.disabled:m.Z.enabled,t?m.Z.checked:m.Z.unchecked,m.Z[s])})})),u&&u]})},h=e=>{let{className:t}=e;return(0,a.tZ)(u.xu,{"aria-hidden":"true",className:t})},g=(0,u.zo)({display:"flex",justifyContent:"center",alignItems:"center",gap:8}),v=_},87077:function(e,t,n){n.d(t,{$$:()=>x,u:()=>P});var i=n(92002),o=n(73580),r=n(7409),a=n(99282),s=n(98848),l=n(16584),c=n(19425),d=n(94184),u=n.n(d),m=n(98661),p=n(62372),_=n(29032),h=n(20160),g=n(20888),v=n(71068),y=n(58076),b=n(19081),f=n(58175),Z=n(165);let w=["top-start","top-center","top-end","bottom-start","bottom-center","bottom-end"],C=["left-start","left-center","left-end","right-start","right-center","right-end"],x=500,P=e=>{var{children:t,text:n,title:i,imageUrl:o,as:c="span",leading:d,trailing:_,preferPlacement:h="top-center",layerOptions:g,disabled:v,hoverOptions:b={},toggleOptions:f}=e,x=(0,s._)(e,["children","text","title","imageUrl","as","leading","trailing","preferPlacement","layerOptions","disabled","hoverOptions","toggleOptions"]);let{layerProps:P,triggerProps:S,hoverProps:N,transitionProps:B,renderLayer:k,shouldShow:M}=function(){var e;let{hoverOptions:t,layerOptions:n,toggleOptions:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[o,a]=(0,m.useState)(!1),[s,l]=(0,p.XI)((0,r._)({},t)),c=i?i.show:s,{triggerProps:d,layerProps:_,renderLayer:h}=(0,p.sJ)((0,r._)({isOpen:c,auto:!0,triggerOffset:8},n)),g=null!==(e=null==n?void 0:n.placement)&&void 0!==e?e:"top-center",v="",y="";switch(g){case"top-start":case"top-center":case"top-end":default:v=u()(Z.Z.hide,Z.Z.fromBelow),y=u()(Z.Z.hide,Z.Z.fromBelow);break;case"bottom-start":case"bottom-center":case"bottom-end":v=u()(Z.Z.hide,Z.Z.fromAbove),y=u()(Z.Z.hide,Z.Z.fromAbove);break;case"left-start":case"left-center":case"left-end":v=u()(Z.Z.hide,Z.Z.fromRight),y=u()(Z.Z.hide,Z.Z.fromRight);break;case"right-start":case"right-center":case"right-end":v=u()(Z.Z.hide,Z.Z.fromLeft),y=u()(Z.Z.hide,Z.Z.fromLeft)}return{layerProps:_,triggerProps:d,hoverProps:l,transitionProps:{show:c,beforeEnter:()=>a(!0),afterLeave:()=>a(!1),enterFrom:v,leaveTo:y},renderLayer:h,shouldShow:c||o}}({layerOptions:(0,r._)({placement:h,possiblePlacements:C.includes(h)?C:w},g),hoverOptions:(0,r._)({delayLeave:50},b),toggleOptions:f}),{style:A}=P,R=(0,s._)(P,["style"]);return v?(0,l.tZ)(l.HY,{children:t}):(0,l.BX)(l.HY,{children:[(0,l.tZ)(c,(0,a._)((0,r._)({},S,N,x),{children:t})),M&&k((0,l.tZ)(I,{transitionProps:B,tooltipProps:(0,a._)((0,r._)({},R,N),{style:(0,a._)((0,r._)({},A),{maxWidth:320,zIndex:y.PU})}),text:n,title:i,imageUrl:o,leading:d,trailing:_}))]})};function I(e){var{transitionProps:t,tooltipProps:n}=e,i=(0,s._)(e,["transitionProps","tooltipProps"]);return(0,l.tZ)("div",(0,a._)((0,r._)({},n),{children:(0,l.tZ)(E,(0,a._)((0,r._)({},t),{children:(0,l.tZ)(S,(0,r._)({},i))}))}))}function S(e){var t=(0,i._)({},(0,o._)(e));return(0,l.tZ)(_.C,{children:(0,l.tZ)(h.W,{children:(0,l.tZ)(F,{children:(0,l.tZ)(N,(0,r._)({},t))})})})}function N(e){let{leading:t,trailing:n,text:i,title:o,imageUrl:r,children:a}=e,s=i&&!o&&!r;return(0,l.BX)(R,{textOnly:!!s,children:[r&&(0,l.tZ)(A,{children:(0,l.tZ)(g.e,{src:r,maxWidth:296,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,l.BX)(M,{hasTitle:!!o,children:[t&&(0,l.tZ)(k,{children:t}),(0,l.BX)(B,{children:[o&&(0,l.tZ)(f.xv.B4,{weight:"medium",color:"primary",className:Z.Z.title,children:o}),(0,l.tZ)(f.xv.B4,{color:"primary",opacity:80,lineHeight:16,children:"string"==typeof i?i.split("\n").map((e,t)=>(0,l.BX)(m.Fragment,{children:[t>0&&(0,l.tZ)("br",{}),e]},t)):i}),a]}),n&&(0,l.tZ)(k,{children:n})]})]})}let B=(0,v.zo)({display:"flex",direction:"column",gap:2});function k(e){let{children:t}=e;return(0,l.tZ)(b.X2,{alignItems:"center",justifyContent:"center",className:Z.Z.endcapContainer,flex:"auto",gap:8,children:t})}function M(e){let{hasTitle:t,children:n}=e;return(0,l.tZ)(b.X2,{alignItems:t?"start":"center",gap:8,children:n})}function A(e){let{children:t}=e;return(0,l.tZ)(b.sg,{border:"detail",radius:"sm",className:Z.Z.imageContainer,overflow:"hidden",children:t})}function R(e){let{textOnly:t,children:n}=e;return(0,l.tZ)(b.sg,{alignItems:"center",paddingY:t?6:12,paddingX:t?8:12,gap:8,children:n})}let F=(0,v.zo)({radius:"sm",shadow:"md",border:"detail",bg:"primary"});function E(e){return(0,l.tZ)(c.u,(0,r._)({appear:!0,unmount:!1,className:Z.Z.animate,enterTo:Z.Z.show,leaveFrom:Z.Z.show},e))}},74583:function(e,t,n){n.d(t,{$:()=>x,f:()=>C});var i=n(7409),o=n(99282),r=n(16584),a=n(30396),s=n(94184),l=n.n(s),c=n(68494),d=n(23970),u=n(95441),m=n(36518),p=n(68833),_=n(7882),h=n(15771),g=n(19081),v=n(84747),y=n(87077),b=n(83010),f=n(74312),Z=n(57693),w=n(21694);function C(e){let{canShowAlerts:t=!1}=e,s=(0,m.lR)(),l=(0,_.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,a.d4)(()=>{s.activityUnreadCount>0&&(0,p.j)(p.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:s.activityUnreadCount})},[s.activityUnreadCount]);let w=()=>Promise.all([n.e("3751"),n.e("5434"),n.e("276"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),{iString:C}=(0,u.M1)();return(0,r.BX)(b.H,{trackingProps:{surface:"dropdown"},children:[(0,r.tZ)(v.M,{trigger:e=>(0,r.tZ)(y.u,{text:C("Activity"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:y.$$},children:(0,r.BX)(h.hU,(0,o._)((0,i._)({},e),{"aria-label":"View activity",priority:"tertiary",onMouseEnter:w,position:"relative",children:[(0,r.tZ)(c.Z,{"aria-hidden":!0,size:20}),s.activityUnreadCount>0&&(0,r.tZ)(x,{count:s.activityUnreadCount})]}))}),onOpen:()=>l.refetch(),maxHeight:"fit-content",padding:0,Theme:d.m,children:(0,r.tZ)(f.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:w,resource:l,bellCount:s.activityUnreadCount,whileLoading:(0,r.tZ)(g.hs,{width:400})})}),t&&(0,r.tZ)(Z.l,{})]})}function x(e){let{count:t}=e;return(0,r.tZ)(g.hs,{className:l()(w.Z.badge,t<10&&w.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},91684:function(e,t,n){n.d(t,{b:()=>v});var i=n(7409),o=n(99282),r=n(16584),a=n(30396),s=n(7617),l=n(23970),c=n(95441),d=n(68833),u=n(80026),m=n(84747),p=n(87077),_=n(97842),h=n(74312),g=n(74583);function v(){var e,t;let{iString:n}=(0,c.M1)(),v=null!==(t=null===(e=(0,_.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,a.d4)(()=>{(0,d.j)(d.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:v})},[v]),(0,r.tZ)(m.M,{trigger:e=>(0,r.tZ)(p.u,{text:n("Chat"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:p.$$},children:(0,r.BX)(u.hU,(0,o._)((0,i._)({},e),{"aria-label":"View chats",priority:"tertiary",onMouseEnter:y,position:"relative",children:[(0,r.tZ)(s.Z,{size:20}),v>0&&(0,r.tZ)(g.$,{count:v})]}))}),onClose:()=>{(0,d.j)(d.FP.CHAT_DROPDOWN_CLOSED)},maxHeight:"fit-content",padding:0,Theme:l.m,children:(0,r.tZ)(h.cr,{module:"./MiniInbox",onRequest:y,resolve:e=>e.MiniChatInbox,whileLoading:(0,r.tZ)(u.xu,{width:360})})})}let y=()=>Promise.all([n.e("7232"),n.e("4327"),n.e("1484"),n.e("5434"),n.e("2340"),n.e("8336"),n.e("276"),n.e("7833"),n.e("2312"),n.e("1026"),n.e("4999"),n.e("7870"),n.e("1209")]).then(n.bind(n,41358))},8113:function(e,t,n){n.d(t,{aM:()=>k});var i=n(7409),o=n(99282),r=n(16584),a=n(30396),s=n(39693),l=n.n(s),c=n(44908),d=n.n(c),u=n(45578),m=n.n(u),p=n(69241),_=n(60807),h=n(12765),g=n(48980),v=n(9682),y=n(98914),b=n(8828),f=n(78308),Z=n(97842),w=n(54584),C=n(86190),x=n(46603),P=n(16889),I=n(91400),S=n(92039),N=n(98012),B=n(17440);function k(e){let{children:t,surface:n}=e,{user:s,userSettings:l}=(0,_.SE)(),c=l.newest_seen_chat_item_published_at,[{path:d}]=(0,v.tv)(),u=(0,I.XA)(),m=(0,S.rG)(),p=(0,S.m)(),[g,y]=(0,h.L)(E,(0,o._)((0,i._)({},Z.UX),{user:s,users:new Map(s?[[s.id,s]]:[])}));(0,Z.WG)({auto:!!s},{onSuccess:e=>{y({type:"inbox-unread_count",payload:e})}});let f=(0,a.sO)(0);return(0,a.d4)(()=>{if(m&&s)return m.listen({["user:".concat(s.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?y(Q(e)):"chat:updated-post"===e.type?y(ee(e)):"chat:new-post"===e.type&&y(et(e))}}})},[m]),(0,a.d4)(()=>{"open"===p&&s&&y((0,b.oH)())},[p]),(0,a.d4)(()=>{if("open"!==p){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;s&&e-f.current>5e3&&"hidden"!==t&&(f.current=e,y((0,b.oH)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},i=(0,P.n)(t);return d.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),i()}}},[c,d,u,y,p]),(0,r.tZ)(w.o.Provider,{value:n,children:(0,r.tZ)(Z.ge.Provider,{value:y,children:(0,r.tZ)(Z.ky.Provider,{value:g,children:t})})})}let M={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},A={isLoading:!1,hasMore:!1,error:null},R={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},F={before:A,after:(0,o._)((0,i._)({},A),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function E(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let r=t.payload,a=null!==(n=e.chats.get(r.id))&&void 0!==n?n:M;return(0,o._)((0,i._)({},e),{chats:(0,B.Rg)(e.chats,r.id,(0,o._)((0,i._)({},a),{publication:r})),publications:(0,B.Rg)(e.publications,r.id,r)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:a,pendingInviteCount:s,pendingInviteUnreadCount:c,mostRecentChatTimestamp:d}=t.payload,u=(0,o._)((0,i._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...l()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...l()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:a}=r;return[r.id,(0,o._)((0,i._)({},e.communityComments.get(a)),{comment:r,userId:r.user_id,quoteId:null!==(n=r.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...l()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:M;return[t.publication.id,(0,o._)((0,i._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...l()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,o._)((0,i._)({},R,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,a,s,l,c,d,u,m;return"chat"===t.type?(0,o._)((0,i._)({},t),{communityPostId:null!==(d=null===(r=t.communityPost)||void 0===r?void 0:r.id)&&void 0!==d?d:null,muteStatus:null!==(u=t.muteStatus)&&void 0!==u?u:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(s=e.user)||void 0===s?void 0:null===(a=s.primary_publication)||void 0===a?void 0:a.id)||(null===(l=e.inbox.threads.get(t.id))||void 0===l?void 0:l.isPrimary)}):(0,o._)((0,i._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(c=t.recentMessage)||void 0===c?void 0:c.id)&&void 0!==m?m:null,isPrimary:!1})}),p=$(m),_=(0,B.zg)(e.inbox.threads,m,e=>e.id),h=$([..._.values()]),{filter:g}=e.inbox,v=(0,f.A)(g);return U((0,o._)((0,i._)({},u),{inbox:(0,o._)((0,i._)({},e.inbox),{resources:(0,o._)((0,i._)({},e.inbox.resources),{[v]:{hasMore:r&&p===h,isLoading:!1}}),threads:_,directMessagesUnreadCount:a,pendingInviteCount:s,pendingInviteUnreadCount:c,mostRecentChatTimestamp:d})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return U((0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s}=t.payload;return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s})})}case"inbox-new_error":return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{resources:(0,o._)((0,i._)({},e.inbox.resources),{[(0,f.A)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return U((0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,V(r),e=>(0,o._)((0,i._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return U((0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,V(n),e=>(0,o._)((0,i._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=V(n.id);return(0,o._)((0,i._)({},e),{chats:(0,B.i4)(e.chats,n.id),inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.i4)(e.inbox.threads,V(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;V(n.id);let r=(0,B.Rg)(e.inbox.threads,V(n.id),{id:V(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,i._)({},U((0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:r}),chats:(0,B.FN)(e.chats,n.id,e=>(0,o._)((0,i._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,B.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,o._)((0,i._)({},e),{conversations:(0,B.Rg)(e.conversations,n,(0,i._)({},r,R))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=W(n);return(0,o._)((0,i._)({},e),{conversations:(0,B.i4)(e.conversations,n),inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.i4)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:a,error:s}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[a].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,o._)((0,i._)({},e),{conversations:(0,B.Rg)(e.conversations,n,(0,o._)((0,i._)({},l),{[a]:{isLoading:!1,cursor:r,error:s}}))})}case"conversation-load_more":{let r;let{edge:a,cursor:s,page:{thread:c,replies:d,publications:u,comments:m,pastCursor:p,futureCursor:_,profile:h,subscriberContext:g}}=t.payload,v=d.map(e=>e.comment.id),y=new Set(v),b=e.conversations.get(c.id);if(!b)return console.error("Attempting to load messages for missing conversation"),e;if(b[a].cursor!==s)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let f=b.replyIds.filter(e=>!y.has(e));f="before"===a?v.concat(f):f.concat(v),r=s?{[a]:{isLoading:!1,cursor:"before"===a?p:_,error:null}}:{before:{isLoading:!1,cursor:p,error:null},after:{isLoading:!1,cursor:_,error:null}};let Z=(0,o._)((0,i._)({},b,r),{thread:c,replyIds:f}),w=h&&(null===(n=c.members.find(e=>e.user_id===h.id))||void 0===n?void 0:n.user),C=(0,o._)((0,i._)({},e),{conversations:(0,B.Rg)(e.conversations,c.id,Z),communityComments:Y(e.communityComments,d.flatMap(e=>l()([e,e.quote]).map(H)),e=>e.comment.id,e=>e.comment.created_at),users:(0,B.zg)(e.users,d.flatMap(e=>{var t;return l()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:h?(0,B.Rg)(e.profiles,h.id,(0,o._)((0,i._)({},w,h),{subscriberContext:g})):e.profiles,publications:u?(0,B.zg)(e.publications,u,e=>e.id):e.publications,notes:m?(0,B.zg)(e.notes,m,e=>"c-".concat(e.id)):e.notes});if("after"===a||!s)return D(C,c.id,null);return C}case"conversation-comments-new":{let{conversationId:n,linkUrl:a,quoteReply:s}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let c={comment:(0,o._)((0,i._)({},T(e,t.payload)),{quote_id:null!==(r=l.quoteReply)&&void 0!==r?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:a?{url:a,host:(0,y.Fo)(a)}:void 0,quote:s,quoteId:null==s?void 0:s.comment.id},d=(0,o._)((0,i._)({},l),{quoteReply:null,replyIds:[...l.replyIds,c.comment.id]});return D((0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,c.comment.id,c),conversations:(0,B.Rg)(e.conversations,n,d)}),n,c.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:a,publications:s,comments:l}=t.payload;n=null!=n?n:a.client_id;let c=e.conversations.get(r);if(!c)throw Error("Attempted to post message to missing conversation");let d=n&&e.communityComments.get(n),u=new Map(e.communityComments),m=H(a);u.set(a.comment.id,d?(0,o._)((0,i._)({},m),{clientId:d.clientId,comment:(0,o._)((0,i._)({},m.comment),{media_uploads:d.comment.media_uploads})}):m),a.quote&&u.set(a.quote.comment.id,H(a.quote));let p=c.replyIds,_=a.comment.id;return n&&(p=p.map(e=>e===n?_:e)),p.includes(_)||(p=[...p,_]),p=[...new Set(p)],D((0,o._)((0,i._)({},e),{conversations:(0,B.Rg)(e.conversations,r,(0,o._)((0,i._)({},c),{replyIds:p})),communityComments:u,publications:s?(0,B.zg)(e.publications,s,e=>e.id):e.publications,notes:l?(0,B.zg)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),r,a.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,a=e.communityComments.get(n);if(!a)throw Error("Attempted to assing error to missing comment");if(!a.isNew)throw Error("Attempted to set error on persisted comment");return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Tried to quote a message in a conversation that does not exist");return(0,o._)((0,i._)({},e),{conversations:(0,B.Rg)(e.conversations,n,(0,o._)((0,i._)({},a),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return j(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,o._)((0,i._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return j(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:i}=t.payload;return j(e,n,{unmute_at:i?(0,N.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=r!==a.comment.reaction;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{comment:z(a.comment,r,s)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,a,s,l,c;let{publication_id:u}=t.payload,m=null!==(n=e.chats.get(u))&&void 0!==n?n:M;switch(t.type){case"posts-request_initial":return(0,o._)((0,i._)({},e),{chats:(0,B.Rg)(e.chats,u,(0,o._)((0,i._)({},m),{after:(0,o._)((0,i._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,o._)((0,i._)({},e),{chats:(0,B.Rg)(e.chats,u,(0,o._)((0,i._)({},m),{before:(0,o._)((0,i._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,a=n.threads.find(e=>"deleted"!==e.communityPost.status),s=Y(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=V(u),c=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},p=(0,o._)((0,i._)({},e),{users:(0,B.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:s,chats:(0,B.Rg)(e.chats,u,(0,o._)((0,i._)({},m,c),{posts:d()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,i;return G(null===(n=s.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(i=s.get(t))||void 0===i?void 0:i.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,l,e=>{var t,r;return"chat"===e.type?(0,o._)((0,i._)({},e),{communityPostId:null!==(t=null==a?void 0:a.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(r=n.lastViewedAt)&&void 0!==r?r:null}):e})})});return(0,o._)((0,i._)({},p),{inbox:"before"===r?e.inbox:(0,o._)((0,i._)({},e.inbox),{threadList:O(p)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,o._)((0,i._)({},e),{chats:(0,B.Rg)(e.chats,u,(0,o._)((0,i._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,V(u),{lastViewedAt:new Date().toISOString()})}),chats:(0,B.Rg)(e.chats,u,(0,o._)((0,i._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),s={communityPost:(0,o._)((0,i._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(a=null===(r=e.user)||void 0===r?void 0:r.id)&&void 0!==a?a:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0};return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,s.communityPost.id,s),chats:(0,B.Rg)(e.chats,u,(0,o._)((0,i._)({},m),{posts:[s.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let a=new Map(e.communityPosts);return a.set(r.communityPost.id,r),(0,o._)((0,i._)({},e),{communityPosts:a})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:a}=t.payload,s=new Map(e.communityPosts);s.set(a,n);let l=Array.from(new Set([a,...m.posts]));return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,V(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,B.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:s,chats:(0,B.Rg)(e.chats,r,(0,o._)((0,i._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:a}=t.payload,s=new Map(e.communityPosts);s.delete(n),s.set(r.communityPost.id,r);let l=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,V(a),{communityPostId:r.communityPost.id})}),communityPosts:s,chats:(0,B.Rg)(e.chats,a,(0,o._)((0,i._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a)||!(null===(s=a.communityPost)||void 0===s?void 0:s.reactions))return console.warn("chat item does not exist"),e;if(a.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},a),{communityPost:z(a.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a)||!(null===(l=a.communityPost)||void 0===l?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},a),{communityPost:z(a.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{L(t,s);let n=e.replies.get(t);n&&n.comments.forEach(e=>{L(e,s)})});let d=null===(c=e.chats.get(r))||void 0===c?void 0:c.posts.filter(t=>{var i;if(t===n)return!1;let o=e.communityPosts.get(t);return(null==o?void 0:null===(i=o.communityPost)||void 0===i?void 0:i.status)!=="deleted"}).sort((t,n)=>{var i,o;let r=null===(i=e.communityPosts.get(t))||void 0===i?void 0:i.communityPost,a=null===(o=e.communityPosts.get(n))||void 0===o?void 0:o.communityPost;return G(null==r?void 0:r.created_at,null==a?void 0:a.created_at)})[0],u=(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},a),{communityPost:(0,o._)((0,i._)({},a.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:s,inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,V(r),e=>"chat"===e.type?(0,o._)((0,i._)({},e),{communityPostId:null!=d?d:null}):e)})});return(0,o._)((0,i._)({},u),{inbox:(0,o._)((0,i._)({},u.inbox),{threadList:O(u)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!K(r))return console.warn("chat item does not exist"),e;return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},r),{communityPost:(0,o._)((0,i._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a))return console.warn("chat item does not exist"),e;return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},a),{communityPost:(0,o._)((0,i._)({},a.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},a),{communityPost:(0,o._)((0,i._)({},a.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:a}=t.payload;return(0,o._)((0,i._)({},e),{chats:(0,B.Rg)(e.chats,n,(0,o._)((0,i._)({},m),{scrollOffset:r,scrollCache:a}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a))return console.warn("post does not exist"),e;return(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,o._)((0,i._)({},a),{communityPost:(0,i._)({},a.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,o._)((0,i._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,a,s,c,u,m,p,_;let h,v=null,y=null;"parentCommentId"in(_=t).payload&&_.payload.parentCommentId?y=t.payload.parentCommentId:"postId"in t.payload&&(v=t.payload.postId);let b=e=>y?{replies:e}:{comments:e};h=y?null!==(n=e.replies.get(y))&&void 0!==n?n:F:v&&null!==(r=e.comments.get(v))&&void 0!==r?r:F;let f=y?e.replies:e.comments,Z=null!=y?y:v;switch(t.type){case"replies-clear":case"comments-clear":return Z?(0,i._)({},e,b((0,B.Rg)(f,Z,F))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,s=(0,o._)((0,i._)({},A),{isLoading:!0,hasMore:!1}),l=r&&(null==h?void 0:h.comments.includes(r.id));return(0,i._)({},e,b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{before:"desc"===n?s:A,after:"asc"===n?s:A,order:n,target:null!=r?r:null,isLoaded:(!r||!!l)&&null!==(a=null==h?void 0:h.isLoaded)&&void 0!==a&&a}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,i._)({},e,b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{[n]:(0,o._)((0,i._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:a,replies:s,more:c,moreAfter:u,moreBefore:m,lastViewedAt:p}}=t.payload,_=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||M;n.muteStatus||(_=(0,B.Rg)(e.chats,r.communityPost.publication_id,(0,o._)((0,i._)({},n),{muteStatus:t})))}let g=s.map(e=>e.comment.id),v=Y(e.communityComments,s.flatMap(e=>l()([e,e.quote]).map(H)),e=>e.comment.id,e=>e.comment.updated_at);if(a)v.set(a.comment.id,(0,o._)((0,i._)({},a),{userId:a.user.id}));let y=(0,B.zg)(e.users,l()([null==r?void 0:r.communityPost.user,null==a?void 0:a.user]),e=>e.id),w=Z?f.get(Z):null,C=(null==w?void 0:w.isLoaded)?{[n]:{isLoading:!1,hasMore:c,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:u,error:null}};return(0,i._)((0,o._)((0,i._)((0,o._)((0,i._)({},e),{communityPosts:r?(0,B.Rg)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:v}),_?{chats:_}:{}),{users:new Map([...y,...s.map(e=>[e.user.id,e.user])])}),b((0,B.Rg)(f,Z,(0,o._)((0,i._)((0,o._)((0,i._)({},h),{comments:d()([...h.comments,...g]).sort((e,t)=>{var n,i;return G(null===(n=v.get(e))||void 0===n?void 0:n.comment.created_at,null===(i=v.get(t))||void 0===i?void 0:i.comment.created_at)}).filter(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),C),{order:"after"!==n||c?h.order:"desc",isLoaded:!0,lastViewedAt:p}))))}case"replies-target":case"comments-target":return Z?(0,i._)({},e,b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,o._)((0,i._)({},e),{communityPosts:(0,B.FN)(e.communityPosts,r,e=>(0,o._)((0,i._)({},e),{communityPost:(0,o._)((0,i._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,o._)((0,i._)({},e),{communityComments:(0,B.FN)(e.communityComments,r,e=>(0,o._)((0,i._)({},e),{comment:(0,o._)((0,i._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return Z?(0,i._)({},e,b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return Z?(0,i._)({},e,b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,o._)((0,i._)({},T(e,n)),{quote_id:null!==(u=null===(s=n.quoteReply)||void 0===s?void 0:s.comment.id)&&void 0!==u?u:null,post_id:n.postId,parent_id:y}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(c=n.quoteReply)||void 0===c?void 0:c.comment.id,pub_roles:n.pubRoles},a=(0,i._)((0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,r.comment.id,r)}),b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(y){let n=e.communityComments.get(y);if(n&&J(n)){let r=X(n.comment,e.user,t.payload.postId);a.communityComments.set(y,(0,o._)((0,i._)({},n),{comment:r}))}}let l=e.communityPosts.get(t.payload.postId);if(l&&K(l)){let n=X(l.communityPost,e.user,t.payload.postId);a.communityPosts=(0,B.Rg)(e.communityPosts,t.payload.postId,(0,o._)((0,i._)({},l),{communityPost:n}))}return a}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,a=new Map(e.communityComments);a.delete(n),a.set(r.comment.id,H(r));let s=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,i._)((0,o._)((0,i._)({},e),{communityComments:a}),b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{comments:s}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let a=h.comments.map(e=>e===n?r.comment.id:e);return(0,i._)((0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,H(r))}),b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{comments:a}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,i._)((0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,H(r)),users:r.user?(0,B.Rg)(e.users,r.userId,r.user):e.users}),b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof g.kp){let t=r.body.post;t&&(e=(0,o._)((0,i._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,t.communityPost.id,(0,o._)((0,i._)({},t),{pubRole:null})),users:t.user?(0,B.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,i._)({},e,b((0,B.Rg)(f,Z,(0,o._)((0,i._)({},h),{[n]:(0,o._)((0,i._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!J(a)||!(null===(m=a.comment)||void 0===m?void 0:m.reactions))return console.warn("comment does not exist"),e;if(a.comment.reaction===r)return console.warn("reaction already set"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{comment:z(a.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!J(a)||!(null===(p=a.comment)||void 0===p?void 0:p.reactions))return console.warn("comment does not exist"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{comment:z(a.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},r),{comment:(0,o._)((0,i._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,a=e.communityComments.get(n);if(!a||!J(a))return console.warn("comment does not exist"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{comment:(0,i._)({},a.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!J(r))return console.warn("comment does not exist"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},r),{comment:(0,o._)((0,i._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,a=e.communityComments.get(n);if(!a||!J(a))return console.warn("comment does not exist"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityComments.get(n);if(!a||!J(a))return console.warn("comment does not exist"),e;if(a.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,o._)((0,i._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,o._)((0,i._)({},a),{comment:(0,o._)((0,i._)({},a.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function X(e,t,n){var r,a;let s;return(t&&t.photo_url&&(s=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(s=m()([...s,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,o._)((0,i._)({},e),{recent_commenters:s,reply_count:1+(null!==(r=e.reply_count)&&void 0!==r?r:0)}):"comment_count"in e?(0,o._)((0,i._)({},e),{recent_commenters:s,comment_count:1+(null!==(a=e.comment_count)&&void 0!==a?a:0)}):e}function L(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,o._)((0,i._)({},n),{comment:(0,o._)((0,i._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function T(e,t){var n,r,a;return(0,o._)((0,i._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(r=t.mediaUploads)&&void 0!==r?r:null,user_id:null!==(a=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==a?a:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function D(e,t,n){let r=W(t),a=e.inbox.threads.get(r),s=(null==a?void 0:a.type)==="direct-message"?a:null,l=(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threads:(0,B.Rg)(e.inbox.threads,r,(0,o._)((0,i._)({timestamp:new Date().toISOString()},s),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,o._)((0,i._)({},l),{inbox:(0,o._)((0,i._)({},e.inbox),{threadList:O(l)})})}function z(e,t,n){var r,a;let s=e.reaction,l=(0,i._)({},e.reactions);return l[t]=(null!==(r=l[t])&&void 0!==r?r:0)+(n?1:-1),n&&s&&(l[s]=(null!==(a=l[s])&&void 0!==a?a:0)-1),(0,o._)((0,i._)({},e),{reactions:l,reaction:n?t:null})}function U(e){return(0,o._)((0,i._)({},e),{inbox:(0,o._)((0,i._)({},e.inbox),{threadList:O(e)})})}function O(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:G(q(e,t),q(e,n))).map(e=>e.id)}function q(e,t){var n,i,o,r;return"chat"===t.type?null!==(o=t.communityPostId&&(null===(i=e.communityPosts.get(t.communityPostId))||void 0===i?void 0:i.communityPost.created_at))&&void 0!==o?o:t.timestamp:null!==(r=null===(n=(0,x._)(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function j(e,t,n){let r=e.conversations.get(t),a=null==r?void 0:r.thread;if(!r||!a)throw Error("Tried to update a conversation that does not exist.");let s=e.user;if(!s)throw Error("Cannot update conversation if the user does not exist.");return(0,o._)((0,i._)({},e),{conversations:(0,B.Rg)(e.conversations,t,(0,o._)((0,i._)({},r),{thread:(0,o._)((0,i._)({},a),{members:a.members.map(e=>e.user_id===s.id?(0,i._)({},e,n):e)})}))})}function V(e){return"chat-".concat(e)}function W(e){return"direct-message-".concat(e)}function H(e){var t,n,r,a;return(0,o._)((0,i._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(a=null!==(r=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==r?r:e.comment.quote_id)&&void 0!==a?a:void 0})}function K(e){return!0!==e.isNew}function J(e){return!0!==e.isNew}function G(e,t){return e===t?0:!t||e&&e>t?-1:1}function Y(e,t,n,o){let r=new Map(e);for(let e of t){let t=n(e),a=r.get(t);if(!a){r.set(t,e);continue}o(e)>=o(a)&&r.set(t,(0,i._)({},a,e))}return r}function $(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var i;let o=null!==(i=n.timestamp)&&void 0!==i?i:t;return o<e?o:e},t)}let Q=e=>async(t,n)=>{let i=e.reply.comment.post_id;n().conversations.get(i)||await t((0,C.U)(i)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,p.JG)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:a}=e;if("deleted"===a.status){t({type:"posts-delete_post",payload:{id:a.id,publication_id:a.publication_id}});return}t({type:"posts-updated",payload:{id:a.id,chatItem:{communityPost:(0,o._)((0,i._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null}}})},et=e=>async t=>{var n,r;let{post:a}=e;t({type:"posts-new_incoming",payload:{publication_id:a.publication_id,id:a.id,chatItem:{communityPost:(0,o._)((0,i._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null}}})}},20521:function(e,t,n){n.d(t,{x:()=>r});var i=n(98012);function o(e){var t;let n=[e.is_primary,(null===(t=e.publication)||void 0===t?void 0:t.author_id)===e.user_id,"admin"===e.role,"contributor"===e.role].map(e=>e?"0":"1").join("");return"".concat(n,"-").concat((0,i.Z)(e.created_at).valueOf())}function r(e){return e.slice(0).sort((e,t)=>o(e)>o(t)?1:-1)}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[3326],{48088:(e,n,i)=>{i.d(n,{h:()=>y});var a=i(64467),l=i(5544),t=i(55364),d=i.n(t),r=i(95420),u=i(96540),s=i(11321),o=i(21335),m=i(34317),k=i(49287),v=i(91830),c={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_user"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"SubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}},{kind:"Argument",name:{kind:"Name",value:"shouldRecordConsent"},value:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}}}]}]}}]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UnsubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unsubscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}}]}]}}]},b={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"FetchOrLazilyCreateNewsletterV3AndMaybeSubscribeMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},w=i(21800),g=i(80452),p=i(2550),V=i(99766);function F(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function f(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?F(Object(i),!0).forEach((function(n){(0,a.A)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}var y=function(e){var n=e.newsletterV3,i=e.creator,a=e.newsletterName,t=e.hideLinkInConfirmationToast,F=void 0!==t&&t,y=n||{},D=y.id,I=y.type,E=y.slug,C=y.collection,O=(null==n?void 0:n.user)||i,A=null!=a?a:null==n?void 0:n.name,T=(0,p.A)().viewerId,_=(0,o.cd)(null==O?void 0:O.id),h=_.viewerEdge,U=_.loading,L=(0,g.h)(),P=u.useState(!1),j=(0,l.A)(P,2),M=j[0],R=j[1],B=(0,s.h)({newsletterSlug:E,collectionSlug:null==C?void 0:C.slug,username:null==O?void 0:O.username}),q=B.viewerEdge,z=B.loading,Q=u.useState(!1),G=(0,l.A)(Q,2),H=G[0],K=G[1];u.useEffect((function(){K(!(null==q||!q.isSubscribed))}),[null==q?void 0:q.isSubscribed]);var Y=(0,m.$L)(),x=(0,k.jI)(),W=(0,v.zF)();M&&Y.event("newsletterV3.subscribe.error",{newsletterV3Id:D});var X=function(e,n,i){if(i){var a={id:"User:".concat(null==O?void 0:O.id),fragment:c,fragmentName:"useNewsletterV3Subscription_user"},l=e.readFragment(a);l&&e.writeFragment(f(f({},a),{},{data:f(f({},l),{},{newsletterV3:i})}))}if(q){var t=e.readQuery({query:V.k,variables:{newsletterSlug:E||"",collectionSlug:(null==C?void 0:C.slug)||null,username:(null==O?void 0:O.username)||null}}),r=d()({},t,{newsletterV3:{viewerEdge:{isSubscribed:n}}});e.writeQuery({query:V.k,variables:{newsletterSlug:E||"",collectionSlug:(null==C?void 0:C.slug)||null,username:(null==O?void 0:O.username)||null},data:r})}if(n&&null!=O&&O.id&&(null==h||!h.isFollowing)){var u=O.id;(0,w.M)({cache:e,userId:u,viewerId:T}),(0,o.YG)(e,u,{isFollowing:!0})}},$=(0,u.useCallback)((function(e){Y.event("newsletterV3.subscribeClicked",{newsletterV3Id:e,source:x}),null!=h&&h.isFollowing||null==O||!O.id||L("user.followed",{targetUserId:O.id})}),[x,Y,null==h?void 0:h.isFollowing,null==O?void 0:O.id,L]),J=(0,u.useCallback)((function(e){return function(n){var i=n.subscribeNewsletterV3;R(!i),i&&($(D),e&&e(),K(!0))}}),[x,D,$]),Z=(0,r.n)(N,{optimisticResponse:{subscribeNewsletterV3:!0},update:function(e){X(e,!0)}}),ee=(0,l.A)(Z,1)[0],ne=(0,u.useCallback)((function(e){return function(n){var i=n.unsubscribeNewsletterV3;R(!i),i&&(Y.event("newsletterV3.unsubscribeClicked",{newsletterV3Id:D,source:x}),K(!1),e?e():W({duration:F?5e3:"NEXTPAGE",toastStyle:"NEWSLETTER_UNSUBSCRIBE",extraParams:{newsletterName:A||null,newsletterType:I||null,unsubscribeFn:function(){return K(!1)},hideEmailSettingsLink:F,hideCloseButton:F}}))}}),[x,D,F,A,I]),ie=(0,r.n)(S,{optimisticResponse:{unsubscribeNewsletterV3:!0},update:function(e){X(e,!1)}}),ae=(0,l.A)(ie,1)[0],le=(0,u.useCallback)((function(e){return function(n){var i=n.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe;R(!i),i&&($(i.id),e&&e(),K(!0))}}),[x,$]),te=(0,r.n)(b,{update:function(e,n){var i,a=f({},null===(i=n.data)||void 0===i?void 0:i.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe);X(e,!0,a)}}),de=(0,l.A)(te,1)[0];return{isSubscribed:H,hasError:M,setSubscribe:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;R(!1),e&&!n&&null!=i&&i.id?de({variables:{userId:null==i?void 0:i.id},onCompleted:le(l)}):e&&null!=n&&n.id?ee({variables:{newsletterV3Id:null==n?void 0:n.id,shouldRecordConsent:a},onCompleted:J(l)}):null!=n&&n.id?ae({variables:{newsletterV3Id:null==n?void 0:n.id},onCompleted:ne(l)}):R(!0)},loading:z||U}}},99766:(e,n,i)=>{i.d(n,{k:()=>a});var a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"NewsletterV3ViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"username"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterSlug"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}}},{kind:"Argument",name:{kind:"Name",value:"collectionSlug"},value:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}}},{kind:"Argument",name:{kind:"Name",value:"username"},value:{kind:"Variable",name:{kind:"Name",value:"username"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3ViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isSubscribed"}}]}}]}},11321:(e,n,i)=>{i.d(n,{h:()=>t});var a=i(95964),l=i(99766),t=function(e){var n,i=e.newsletterSlug,t=void 0===i?"":i,d=e.collectionSlug,r=void 0===d?null:d,u=e.username,s=void 0===u?null:u,o=(0,a.IT)(l.k,{variables:{newsletterSlug:t,collectionSlug:r,username:s},ssr:!1,skip:!t&&!s}),m=o.loading,k=o.error,v=o.data;return m?{loading:m}:k?{error:k}:{viewerEdge:null==v||null===(n=v.newsletterV3)||void 0===n?void 0:n.viewerEdge}}},21335:(e,n,i)=>{i.d(n,{sf:()=>s,YG:()=>r,cd:()=>u});var a=i(55364),l=i.n(a),t=i(95964),d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"User_viewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"User_viewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}},{kind:"Field",name:{kind:"Name",value:"hasCompletedProfile"}},{kind:"Field",name:{kind:"Name",value:"isAllowEdsEnabled"}},{kind:"Field",name:{kind:"Name",value:"isBlocking"}},{kind:"Field",name:{kind:"Name",value:"isFollowing"}},{kind:"Field",name:{kind:"Name",value:"isMuting"}},{kind:"Field",name:{kind:"Name",value:"isFacebookFollowing"}},{kind:"Field",name:{kind:"Name",value:"isMediumFollowing"}},{kind:"Field",name:{kind:"Name",value:"isSuperFollowing"}},{kind:"Field",name:{kind:"Name",value:"isTwitterFollowing"}},{kind:"Field",name:{kind:"Name",value:"isUser"}},{kind:"Field",name:{kind:"Name",value:"lastPostCreatedAt"}},{kind:"Field",name:{kind:"Name",value:"readPostsCount"}}]}}]};function r(e,n,i){var a=e.readQuery({query:d,variables:{userId:n}}),t=l()({},a,{user:{viewerEdge:i}});e.writeQuery({query:d,variables:{userId:n||""},data:t})}var u=function(e){var n,i=(0,t.IT)(d,{variables:{userId:null!=e?e:""},ssr:!1,skip:!e}),a=i.loading,l=i.error,r=i.data;return a?{loading:a}:l?{error:l}:{viewerEdge:null==r||null===(n=r.user)||void 0===n?void 0:n.viewerEdge}},s=function(e,n){var i=n.userId,a=n.viewerId;return e.identify({__typename:"UserViewerEdge",id:"userId:".concat(i,"-viewerId:").concat(a)})}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/3326.8a80e879.chunk.js.map